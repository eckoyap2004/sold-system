<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SOLD Leyte Province - Complete Growth Management System</title>
    <style>
        :root {
            --sold-blue: #1a237e;
            --sold-light-blue: #283593;
            --sold-gold: #FFD700;
            --sold-green: #2E7D32;
            --sold-red: #C62828;
            --sold-purple: #6A1B9A;
            --sold-orange: #EF6C00;
            --sold-teal: #00695C;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Arial', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #f5f7fa 0%, #e8eaf6 100%);
            color: #333;
            min-height: 100vh;
        }

        .header {
            background: linear-gradient(135deg, var(--sold-blue) 0%, var(--sold-light-blue) 100%);
            color: white;
            padding: 1rem 2rem;
            box-shadow: 0 4px 20px rgba(26, 35, 126, 0.3);
            position: sticky;
            top: 0;
            z-index: 1000;
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 0.5rem;
        }

        .logo-container {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .logo {
            font-size: 2.5rem;
            color: var(--sold-gold);
            font-weight: bold;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }

        .logo-text {
            font-size: 1.6rem;
            font-weight: 700;
            letter-spacing: 1px;
        }

        .subtitle {
            text-align: center;
            font-size: 1.2rem;
            opacity: 0.95;
            padding: 0.3rem;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 5px;
            margin-top: 0.3rem;
        }

        .container {
            max-width: 1800px;
            margin: 0 auto;
            padding: 1.5rem;
        }

        .tabs {
            display: flex;
            background: white;
            border-radius: 12px 12px 0 0;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            margin-bottom: 0;
            flex-wrap: wrap;
        }

        .tab {
            padding: 1rem 1.2rem;
            cursor: pointer;
            font-weight: 600;
            color: #555;
            transition: all 0.3s ease;
            border-bottom: 4px solid transparent;
            text-align: center;
            flex: 1;
            min-width: 120px;
            position: relative;
            overflow: hidden;
        }

        .tab:hover {
            background: linear-gradient(to bottom, rgba(41, 98, 255, 0.1), transparent);
            color: var(--sold-blue);
        }

        .tab.active {
            color: var(--sold-blue);
            border-bottom: 4px solid var(--sold-gold);
            background: linear-gradient(to bottom, rgba(41, 98, 255, 0.05), transparent);
        }

        .tab-icon {
            display: block;
            font-size: 1.4rem;
            margin-bottom: 0.3rem;
        }

        .tab-content {
            display: none;
            background: white;
            padding: 2rem;
            border-radius: 0 0 12px 12px;
            box-shadow: 0 8px 30px rgba(0, 0, 0, 0.1);
            min-height: 700px;
            animation: fadeIn 0.5s ease;
        }

        .tab-content.active {
            display: block;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(15px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .section-title {
            color: var(--sold-blue);
            margin: 1.5rem 0 1rem 0;
            padding-bottom: 0.5rem;
            border-bottom: 2px solid var(--sold-gold);
            font-size: 1.5rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .btn {
            background: linear-gradient(135deg, var(--sold-blue) 0%, var(--sold-light-blue) 100%);
            color: white;
            border: none;
            padding: 0.6rem 1.2rem;
            border-radius: 6px;
            font-size: 0.9rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(26, 35, 126, 0.2);
            display: inline-flex;
            align-items: center;
            gap: 0.5rem;
        }

        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(26, 35, 126, 0.3);
        }

        .btn-small {
            padding: 0.3rem 0.8rem;
            font-size: 0.8rem;
        }

        .btn-success {
            background: linear-gradient(135deg, var(--sold-green) 0%, #4CAF50 100%);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--sold-red) 0%, #F44336 100%);
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--sold-orange) 0%, #FF9800 100%);
        }

        .btn-purple {
            background: linear-gradient(135deg, var(--sold-purple) 0%, #8E24AA 100%);
        }

        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--sold-blue) 0%, var(--sold-light-blue) 100%);
            border-radius: 10px;
            padding: 1.2rem;
            color: white;
            text-align: center;
            box-shadow: 0 6px 20px rgba(26, 35, 126, 0.2);
        }

        .stat-value {
            font-size: 2.2rem;
            font-weight: 800;
            margin: 0.3rem 0;
            color: var(--sold-gold);
        }

        .stat-label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .form-group {
            margin-bottom: 1rem;
        }

        .form-group label {
            display: block;
            margin-bottom: 0.3rem;
            font-weight: 600;
            color: var(--sold-blue);
            font-size: 0.9rem;
        }

        .form-control {
            width: 100%;
            padding: 0.6rem 0.8rem;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .form-control:focus {
            border-color: var(--sold-blue);
            outline: none;
            box-shadow: 0 0 0 3px rgba(26, 35, 126, 0.1);
        }

        .grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.2rem;
            margin-bottom: 1.5rem;
        }

        .grid-2 {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1.2rem;
        }

        .grid-3 {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 1.2rem;
        }

        .card {
            background: white;
            border-radius: 10px;
            padding: 1.2rem;
            border-left: 4px solid var(--sold-blue);
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            transition: all 0.3s ease;
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.12);
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 1rem 0;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.05);
        }

        th {
            background: linear-gradient(135deg, var(--sold-blue) 0%, var(--sold-light-blue) 100%);
            color: white;
            padding: 0.8rem;
            text-align: left;
            font-weight: 600;
            font-size: 0.9rem;
        }

        td {
            padding: 0.8rem;
            border-bottom: 1px solid #eef2f7;
            font-size: 0.9rem;
        }

        tr:hover {
            background-color: #f8f9fa;
        }

        .action-buttons {
            display: flex;
            gap: 0.3rem;
        }

        .pill {
            display: inline-block;
            padding: 0.2rem 0.6rem;
            border-radius: 15px;
            font-size: 0.75rem;
            font-weight: 600;
            margin: 0.1rem;
        }

        .pill-active { background: #E8F5E9; color: var(--sold-green); }
        .pill-inactive { background: #FFEBEE; color: var(--sold-red); }
        .pill-regular { background: #E3F2FD; color: #1565C0; }
        .pill-leader { background: #FFF3E0; color: var(--sold-orange); }
        .pill-attended { background: #E8F5E9; color: var(--sold-green); }
        .pill-pending { background: #FFF3E0; color: var(--sold-orange); }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.5);
            z-index: 2000;
            justify-content: center;
            align-items: center;
        }

        .modal-content {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            max-width: 900px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-lg {
            max-width: 1200px;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #666;
        }

        .tabs-secondary {
            display: flex;
            border-bottom: 2px solid #eee;
            margin-bottom: 1.5rem;
        }

        .tab-secondary {
            padding: 0.5rem 1rem;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            font-weight: 600;
            color: #666;
        }

        .tab-secondary.active {
            color: var(--sold-blue);
            border-bottom: 3px solid var(--sold-blue);
        }

        .search-container {
            margin: 1rem 0;
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .search-input {
            flex: 1;
            padding: 0.6rem 1rem;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 0.9rem;
        }

        .footer {
            text-align: center;
            margin-top: 2rem;
            padding: 1.5rem;
            color: #666;
            background: linear-gradient(135deg, #f8f9fa 0%, #e8eaf6 100%);
            border-top: 1px solid #ddd;
        }

        .year-selector {
            display: flex;
            gap: 0.5rem;
            align-items: center;
            margin-bottom: 1rem;
            flex-wrap: wrap;
        }

        .year-btn {
            padding: 0.3rem 0.8rem;
            background: #f0f0f0;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-weight: 600;
        }

        .year-btn.active {
            background: var(--sold-blue);
            color: white;
        }

        .monthly-breakdown {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .month-card {
            background: #f8f9fa;
            padding: 0.8rem;
            border-radius: 8px;
            text-align: center;
        }

        /* Photo Gallery */
        .photo-gallery {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }

        .photo-card {
            background: white;
            border-radius: 10px;
            overflow: hidden;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            transition: transform 0.3s ease;
            position: relative;
        }

        .photo-card:hover {
            transform: translateY(-5px);
        }

        .photo-img {
            width: 100%;
            height: 200px;
            object-fit: cover;
            background: linear-gradient(135deg, var(--sold-blue) 0%, var(--sold-light-blue) 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            color: white;
            font-size: 3rem;
        }

        .photo-details {
            padding: 1rem;
        }

        .photo-title {
            font-weight: 600;
            margin-bottom: 0.5rem;
            color: var(--sold-blue);
        }

        .photo-meta {
            font-size: 0.8rem;
            color: #666;
        }

        .photo-actions {
            position: absolute;
            top: 10px;
            right: 10px;
            display: flex;
            gap: 0.3rem;
        }

        /* Graph Container */
        .graph-container {
            background: white;
            border-radius: 10px;
            padding: 1.5rem;
            margin: 1rem 0;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.08);
            height: 400px;
            position: relative;
        }

        /* Member Selection Grid */
        .member-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
            max-height: 400px;
            overflow-y: auto;
            padding: 1rem;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
        }

        .member-checkbox {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem;
            border: 1px solid #e0e0e0;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .member-checkbox:hover {
            border-color: var(--sold-blue);
            background: #f0f7ff;
        }

        .member-checkbox.selected {
            border-color: var(--sold-green);
            background: #f0fff4;
        }

        .member-checkbox input[type="checkbox"] {
            margin: 0;
        }

        /* Household Cards */
        .household-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(350px, 1fr));
            gap: 1rem;
        }

        .household-card {
            background: linear-gradient(135deg, #f8f9fa 0%, #eef2f7 100%);
            border-radius: 10px;
            padding: 1.2rem;
            border-left: 5px solid var(--sold-green);
            position: relative;
        }

        .household-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1rem;
        }

        .household-name {
            font-weight: 600;
            color: var(--sold-blue);
            font-size: 1.1rem;
        }

        /* Toast Notifications */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--sold-green);
            color: white;
            padding: 1rem 1.5rem;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.2);
            z-index: 3000;
            display: flex;
            align-items: center;
            gap: 0.8rem;
            transform: translateX(150%);
            transition: transform 0.3s ease;
        }

        .toast.show {
            transform: translateX(0);
        }

        .toast.error {
            background: var(--sold-red);
        }

        .toast.warning {
            background: var(--sold-orange);
        }

        /* Data Management */
        .data-management {
            display: flex;
            gap: 1rem;
            margin: 1rem 0;
            flex-wrap: wrap;
        }

        /* About SOLD Section */
        .about-sold {
            background: linear-gradient(135deg, #f8f9fa 0%, #e8eaf6 100%);
            border-radius: 10px;
            padding: 2rem;
            margin-bottom: 2rem;
            border-left: 5px solid var(--sold-gold);
        }

        .about-header {
            display: flex;
            align-items: center;
            gap: 1rem;
            margin-bottom: 1.5rem;
        }

        .about-logo {
            font-size: 3rem;
            color: var(--sold-gold);
            background: var(--sold-blue);
            width: 80px;
            height: 80px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .about-content {
            line-height: 1.8;
        }

        .about-content h3 {
            color: var(--sold-blue);
            margin: 1.5rem 0 0.5rem 0;
        }

        .about-content ul {
            margin-left: 2rem;
            margin-bottom: 1rem;
        }

        .timeline {
            position: relative;
            padding: 2rem 0;
        }

        .timeline-item {
            position: relative;
            padding-left: 2.5rem;
            margin-bottom: 2rem;
            border-left: 3px solid var(--sold-gold);
        }

        .timeline-year {
            position: absolute;
            left: -15px;
            top: 0;
            background: var(--sold-blue);
            color: white;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: bold;
        }

        /* Print Styles */
        @media print {
            body * {
                visibility: hidden;
            }
            
            .print-section, .print-section * {
                visibility: visible;
            }
            
            .print-section {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                padding: 20px;
                background: white;
            }
            
            .no-print {
                display: none !important;
            }
            
            .page-break {
                page-break-after: always;
            }
            
            .print-logo {
                text-align: center;
                margin-bottom: 20px;
            }
            
            .print-header {
                text-align: center;
                border-bottom: 3px solid var(--sold-gold);
                padding-bottom: 10px;
                margin-bottom: 20px;
            }
            
            .print-footer {
                position: fixed;
                bottom: 0;
                width: 100%;
                text-align: center;
                font-size: 0.8rem;
                color: #666;
                border-top: 1px solid #ddd;
                padding-top: 10px;
            }
        }

        /* Print Preview Modal */
        .print-preview {
            background: white;
            padding: 2rem;
            border-radius: 12px;
            max-width: 800px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .tabs {
                flex-direction: column;
            }
            
            .tab {
                flex: none;
                width: 100%;
            }
            
            .grid, .grid-2, .grid-3 {
                grid-template-columns: 1fr;
            }
            
            .header-top {
                flex-direction: column;
                gap: 0.5rem;
                text-align: center;
            }
            
            .monthly-breakdown {
                grid-template-columns: repeat(3, 1fr);
            }
            
            .photo-gallery {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            }
            
            .member-grid {
                grid-template-columns: 1fr;
            }
            
            .search-container {
                flex-direction: column;
            }
            
            .search-container > * {
                width: 100%;
            }
        }
    </style>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="header">
        <div class="header-top">
            <div class="logo-container">
                <div class="logo">SOLD</div>
                <div>
                    <div class="logo-text">Servants of the Lord</div>
                    <div style="font-size: 0.9rem; opacity: 0.9;">Leyte Province - Growth Management System (2026-2031)</div>
                    <div style="font-size: 0.9rem; opacity: 0.9;">Coded By - Andriane Yap | BOSbyJecko System | 01052026 </div>
                </div>
            </div>
            <div style="color: var(--sold-gold); font-size: 0.9rem; font-weight: 600;">
                <i class="fas fa-calendar-alt"></i> 2026-2031 Growth Cycle
            </div>
        </div>
        <div class="subtitle">
            "Renewing the Face of the Earth" • Documenting Growth & Development 2026-2031
        </div>
    </div>

    <div class="container">
        <div class="tabs" id="tabs">
            <div class="tab active" data-tab="dashboard">
                <i class="tab-icon fas fa-tachometer-alt"></i> Dashboard
            </div>
            <div class="tab" data-tab="about">
                <i class="tab-icon fas fa-info-circle"></i> About SOLD
            </div>
            <div class="tab" data-tab="households">
                <i class="tab-icon fas fa-home"></i> Households
            </div>
            <div class="tab" data-tab="members">
                <i class="tab-icon fas fa-users"></i> Members
            </div>
            <div class="tab" data-tab="formations">
                <i class="tab-icon fas fa-graduation-cap"></i> Formation Talks
            </div>
            <div class="tab" data-tab="tithing">
                <i class="tab-icon fas fa-hand-holding-usd"></i> Tithing
            </div>
            <div class="tab" data-tab="growth">
                <i class="tab-icon fas fa-chart-line"></i> Growth Analytics
            </div>
            <div class="tab" data-tab="reports">
                <i class="tab-icon fas fa-file-alt"></i> Reports
            </div>
            <div class="tab" data-tab="gallery">
                <i class="tab-icon fas fa-images"></i> Photo Gallery
            </div>
            <div class="tab" data-tab="data">
                <i class="tab-icon fas fa-database"></i> Data Management
            </div>
        </div>

        <!-- Dashboard Tab -->
        <div id="dashboard" class="tab-content active">
            <div class="about-sold" style="margin-bottom: 2rem;">
                <div class="about-header">
                    <div class="about-logo">
                        <i class="fas fa-cross"></i>
                    </div>
                    <div>
                        <h2 style="color: var(--sold-blue); margin-bottom: 0.5rem;">Servants of the Lord (SOLD)</h2>
                        <p style="color: #666;">"Renewing the Face of the Earth"</p>
                    </div>
                </div>
                <div class="about-content">
                    <p><strong>SOLD (Servants of the Lord)</strong> is a Catholic movement for widowers, single men, and mature single men who have never been married. It is one of the family ministries of Couples for Christ (CFC), dedicated to renewing and strengthening the faith of its members through prayer, fellowship, and service.</p>
                    
                    <div class="grid-3" style="margin-top: 1.5rem;">
                        <div class="card">
                            <h4><i class="fas fa-bullseye"></i> Vision</h4>
                            <p>"Families in the Holy Spirit Renewing the Face of the Earth"</p>
                        </div>
                        <div class="card">
                            <h4><i class="fas fa-flag"></i> Mission</h4>
                            <p>To build the Church of the Home and the Church of the Poor</p>
                        </div>
                        <div class="card">
                            <h4><i class="fas fa-heart"></i> Core Values</h4>
                            <p>Pro-God, Pro-Family, Pro-Poor, Pro-Life</p>
                        </div>
                    </div>
                </div>
            </div>

            <div class="stats-container">
                <div class="stat-card">
                    <div class="stat-label">Total Households</div>
                    <div class="stat-value" id="totalHouseholds">0</div>
                    <div>Active HPMs</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Total Members</div>
                    <div class="stat-value" id="totalMembers">0</div>
                    <div>SOLD Leyte</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Yearly Tithes</div>
                    <div class="stat-value" id="yearlyTithes">₱0</div>
                    <div id="currentYear">2026</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Formations Completed</div>
                    <div class="stat-value" id="formationsCompleted">0</div>
                    <div>This Year</div>
                </div>
            </div>

            <div class="grid-2">
                <div class="card">
                    <h3 class="section-title">
                        <i class="fas fa-chart-line"></i> Growth Overview
                        <select class="form-control" style="width: 150px;" id="growthMetric">
                            <option value="members">Members Growth</option>
                            <option value="households">Households Growth</option>
                            <option value="tithing">Tithing Growth</option>
                            <option value="formations">Formations Growth</option>
                        </select>
                    </h3>
                    <div class="graph-container">
                        <canvas id="growthChart"></canvas>
                    </div>
                </div>

                <div class="card">
                    <h3 class="section-title">
                        <i class="fas fa-map-marked-alt"></i> Area Distribution
                    </h3>
                    <div class="graph-container">
                        <canvas id="areaChart"></canvas>
                    </div>
                </div>
            </div>

            <h3 class="section-title">
                <i class="fas fa-images"></i> Recent Activities Gallery
                <button class="btn btn-success" onclick="openModal('addPhotoModal')">
                    <i class="fas fa-plus"></i> Add Photo
                </button>
            </h3>

            <div class="photo-gallery" id="recentPhotos">
                <!-- Photos will be loaded here -->
            </div>

            <h3 class="section-title">Recent Activities</h3>
            <div class="card">
                <table id="recentActivitiesTable">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Activity</th>
                            <th>Location</th>
                            <th>Attendees</th>
                            <th>Status</th>
                        </tr>
                    </thead>
                    <tbody id="recentActivities">
                        <!-- Activities will be loaded here -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- About SOLD Tab -->
        <div id="about" class="tab-content">
            <div class="about-sold">
                <div class="about-header">
                    <div class="about-logo">
                        <i class="fas fa-cross"></i>
                    </div>
                    <div>
                        <h1 style="color: var(--sold-blue); margin-bottom: 0.5rem;">Servants of the Lord (SOLD)</h1>
                        <p style="color: var(--sold-gold); font-size: 1.2rem; font-weight: 600;">"Renewing the Face of the Earth"</p>
                    </div>
                </div>
                
                <div class="about-content">
                    <h3>What is SOLD?</h3>
                    <p>Servants of the Lord (SOLD) is a Catholic movement for widowers, single men, and mature single men who have never been married. It is one of the family ministries of Couples for Christ (CFC), founded to provide spiritual support, fellowship, and formation for men in these life situations.</p>
                    
                    <h3>Historical Background</h3>
                    <div class="timeline">
                        <div class="timeline-item">
                            <div class="timeline-year">1981</div>
                            <h4>Foundation of CFC</h4>
                            <p>Couples for Christ was founded in Manila, Philippines by 16 couples with the guidance of Fr. Herb Schneider, SJ.</p>
                        </div>
                        <div class="timeline-item">
                            <div class="timeline-year">1993</div>
                            <h4>Expansion to Family Ministries</h4>
                            <p>CFC expanded to include various family ministries to cater to different demographics within the Catholic family.</p>
                        </div>
                        <div class="timeline-item">
                            <div class="timeline-year">2000</div>
                            <h4>Establishment of SOLD</h4>
                            <p>Servants of the Lord was officially established as a ministry for widowers and single men, complementing the existing family ministries.</p>
                        </div>
                        <div class="timeline-item">
                            <div class="timeline-year">Present</div>
                            <h4>Global Presence</h4>
                            <p>SOLD has grown to become an integral part of CFC's family ministries, present in many countries worldwide.</p>
                        </div>
                    </div>
                    
                    <h3>SOLD Structure in Leyte Province</h3>
                    <div class="grid-3">
                        <div class="card">
                            <h4><i class="fas fa-sitemap"></i> Organizational Structure</h4>
                            <ul>
                                <li>Provincial Coordinator</li>
                                <li>Area Coordinators</li>
                                <li>Chapter Heads</li>
                                <li>Household Leaders</li>
                                <li>Members</li>
                            </ul>
                        </div>
                        <div class="card">
                            <h4><i class="fas fa-pray"></i> Spiritual Activities</h4>
                            <ul>
                                <li>Weekly Household Prayer Meetings</li>
                                <li>Monthly Formation Talks</li>
                                <li>Quarterly Assemblies</li>
                                <li>Annual Retreats</li>
                                <li>Service Projects</li>
                            </ul>
                        </div>
                        <div class="card">
                            <h4><i class="fas fa-chart-line"></i> Growth Focus 2026-2031</h4>
                            <ul>
                                <li>Membership Increase</li>
                                <li>Household Multiplication</li>
                                <li>Leadership Development</li>
                                <li>Service Expansion</li>
                                <li>Spiritual Growth</li>
                            </ul>
                        </div>
                    </div>
                    
                    <h3>SOLD Leyte Province Coverage</h3>
                    <p>SOLD Leyte Province covers all 45 municipalities and cities of Leyte, with focus on establishing strong Household Prayer Meetings (HPMs) in each area. The province is divided into clusters for better pastoral care and coordination.</p>
                    
                    <div class="card" style="margin-top: 1.5rem;">
                        <h4><i class="fas fa-bullseye"></i> SOLD Leyte Vision 2031</h4>
                        <p>"By 2031, SOLD Leyte aims to have at least one active Household Prayer Meeting in every municipality of Leyte Province, with strong leadership formation and active participation in the evangelization mission of the Church."</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Households Tab -->
        <div id="households" class="tab-content">
            <h3 class="section-title">
                <i class="fas fa-home"></i> Household Prayer Meetings (HPM)
                <button class="btn btn-success" onclick="openModal('addHouseholdModal')">
                    <i class="fas fa-plus"></i> Add Household
                </button>
            </h3>

            <div class="search-container">
                <input type="text" class="search-input" id="householdSearch" placeholder="Search households by name, area, or leader..." onkeyup="filterHouseholds()">
                <select class="form-control" style="width: 200px;" id="householdAreaFilter" onchange="filterHouseholds()">
                    <option value="">All Areas</option>
                </select>
                <select class="form-control" style="width: 200px;" id="householdStatusFilter" onchange="filterHouseholds()">
                    <option value="">All Status</option>
                    <option value="active">Active</option>
                    <option value="inactive">Inactive</option>
                </select>
            </div>

            <div class="household-cards" id="householdList">
                <!-- Households will be loaded here -->
            </div>

            <h3 class="section-title">Household Details</h3>
            <div class="card">
                <table id="householdsTable">
                    <thead>
                        <tr>
                            <th>Household Name</th>
                            <th>Area</th>
                            <th>Leader</th>
                            <th>Members</th>
                            <th>Residence</th>
                            <th>Meeting Day</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="householdsData">
                        <!-- Household data will be loaded here -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Members Tab -->
        <div id="members" class="tab-content">
            <h3 class="section-title">
                <i class="fas fa-users"></i> SOLD Members Directory
                <button class="btn btn-success" onclick="openModal('addMemberModal')">
                    <i class="fas fa-plus"></i> Add Member
                </button>
            </h3>

            <div class="search-container">
                <input type="text" class="search-input" id="memberSearch" placeholder="Search members by name, area, or functionality..." onkeyup="filterMembers()">
                <select class="form-control" style="width: 200px;" id="memberAreaFilter" onchange="filterMembers()">
                    <option value="">All Areas</option>
                </select>
                <select class="form-control" style="width: 200px;" id="memberStatusFilter" onchange="filterMembers()">
                    <option value="">All Status</option>
                    <option value="active">Active</option>
                    <option value="inactive">Inactive</option>
                    <option value="transferred">Transferred</option>
                </select>
            </div>

            <div class="tabs-secondary" id="memberTabs">
                <div class="tab-secondary active" data-member-filter="all">All Members</div>
                <div class="tab-secondary" data-member-filter="leaders">Leaders</div>
                <div class="tab-secondary" data-member-filter="new">New This Year</div>
                <div class="tab-secondary" data-member-filter="need_followup">Need Follow-up</div>
            </div>

            <div class="card">
                <table id="membersTable">
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Birthday</th>
                            <th>Area</th>
                            <th>Household</th>
                            <th>Functionality</th>
                            <th>Member Since</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="membersList">
                        <!-- Members will be loaded here -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Formation Talks Tab -->
        <div id="formations" class="tab-content">
            <h3 class="section-title">
                <i class="fas fa-graduation-cap"></i> 3-Year Formation Program (2026-2029)
                <button class="btn btn-success" onclick="openModal('addFormationModal')">
                    <i class="fas fa-plus"></i> Schedule Talk
                </button>
            </h3>

            <div class="tabs-secondary" id="formationTabs">
                <div class="tab-secondary active" data-formation-year="2026">Year 1: 2026</div>
                <div class="tab-secondary" data-formation-year="2027">Year 2: 2027</div>
                <div class="tab-secondary" data-formation-year="2028">Year 3: 2028</div>
                <div class="tab-secondary" data-formation-year="2029">Year 4: 2029</div>
                <div class="tab-secondary" data-formation-year="2030">Year 5: 2030</div>
                <div class="tab-secondary" data-formation-year="2031">Year 6: 2031</div>
            </div>

            <div class="year-selector">
                <span>Filter by Area:</span>
                <select class="form-control" style="width: 200px;" id="formationAreaFilter" onchange="filterFormations()">
                    <option value="">All Areas</option>
                </select>
                <select class="form-control" style="width: 200px;" id="formationStatusFilter" onchange="filterFormations()">
                    <option value="">All Status</option>
                    <option value="upcoming">Upcoming</option>
                    <option value="completed">Completed</option>
                    <option value="cancelled">Cancelled</option>
                </select>
            </div>

            <div class="grid">
                <div class="card">
                    <h4><i class="fas fa-calendar"></i> Upcoming Talks</h4>
                    <div id="upcomingTalks">
                        <!-- Upcoming talks will be loaded here -->
                    </div>
                </div>
                <div class="card">
                    <h4><i class="fas fa-chart-bar"></i> Attendance Summary</h4>
                    <div id="attendanceSummary">
                        <!-- Attendance summary will be loaded here -->
                    </div>
                </div>
                <div class="card">
                    <h4><i class="fas fa-user-clock"></i> Need Follow-up</h4>
                    <div id="followupList">
                        <!-- Members needing follow-up will be loaded here -->
                    </div>
                </div>
            </div>

            <h3 class="section-title">Formation Talks Schedule</h3>
            <div class="card">
                <table id="formationsTable">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Talk Topic</th>
                            <th>Area</th>
                            <th>Venue</th>
                            <th>Speaker</th>
                            <th>Attendees</th>
                            <th>Status</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="formationsList">
                        <!-- Formations will be loaded here -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Tithing Tab -->
        <div id="tithing" class="tab-content">
            <h3 class="section-title">
                <i class="fas fa-hand-holding-usd"></i> Tithing Management
                <button class="btn btn-success" onclick="openModal('recordTitheModal')">
                    <i class="fas fa-plus"></i> Record Tithe
                </button>
            </h3>

            <div class="year-selector">
                <span>Year:</span>
                <button class="year-btn active" onclick="changeTithingYear(2026)">2026</button>
                <button class="year-btn" onclick="changeTithingYear(2027)">2027</button>
                <button class="year-btn" onclick="changeTithingYear(2028)">2028</button>
                <button class="year-btn" onclick="changeTithingYear(2029)">2029</button>
                <button class="year-btn" onclick="changeTithingYear(2030)">2030</button>
                <button class="year-btn" onclick="changeTithingYear(2031)">2031</button>
            </div>

            <div class="stats-container">
                <div class="stat-card">
                    <div class="stat-label">Year to Date Total</div>
                    <div class="stat-value" id="ytdTotal">₱0</div>
                    <div id="ytdYear">2026</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Monthly Average</div>
                    <div class="stat-value" id="monthlyAverage">₱0</div>
                    <div>Current Year</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Total Contributors</div>
                    <div class="stat-value" id="totalContributors">0</div>
                    <div>Active Tithers</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Highest Contributor</div>
                    <div class="stat-value" id="highestContributor">₱0</div>
                    <div id="contributorName">-</div>
                </div>
            </div>

            <h3 class="section-title">Monthly Breakdown - <span id="selectedYear">2026</span></h3>
            <div class="card">
                <div class="monthly-breakdown" id="monthlyTithing">
                    <!-- Monthly breakdown will be loaded here -->
                </div>
            </div>

            <h3 class="section-title">Tithing Records</h3>
            <div class="search-container">
                <input type="text" class="search-input" id="titheSearch" placeholder="Search by member name..." onkeyup="filterTithes()">
                <select class="form-control" style="width: 200px;" id="titheMonthFilter" onchange="filterTithes()">
                    <option value="">All Months</option>
                    <option value="1">January</option>
                    <option value="2">February</option>
                    <option value="3">March</option>
                    <option value="4">April</option>
                    <option value="5">May</option>
                    <option value="6">June</option>
                    <option value="7">July</option>
                    <option value="8">August</option>
                    <option value="9">September</option>
                    <option value="10">October</option>
                    <option value="11">November</option>
                    <option value="12">December</option>
                </select>
                <select class="form-control" style="width: 200px;" id="titheAreaFilter" onchange="filterTithes()">
                    <option value="">All Areas</option>
                </select>
            </div>

            <div class="card">
                <table id="tithingTable">
                    <thead>
                        <tr>
                            <th>Date</th>
                            <th>Member Name</th>
                            <th>Amount</th>
                            <th>Type</th>
                            <th>Area</th>
                            <th>Month/Year</th>
                            <th>Receipt #</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                    <tbody id="tithingList">
                        <!-- Tithing records will be loaded here -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Growth Analytics Tab -->
        <div id="growth" class="tab-content">
            <h3 class="section-title">
                <i class="fas fa-chart-line"></i> SOLD Leyte Growth Analytics (2026-2031)
            </h3>

            <div class="year-selector">
                <span>Compare Years:</span>
                <button class="year-btn active" onclick="viewGrowthYear('all')">All Years</button>
                <button class="year-btn" onclick="viewGrowthYear(2026)">2026</button>
                <button class="year-btn" onclick="viewGrowthYear(2027)">2027</button>
                <button class="year-btn" onclick="viewGrowthYear(2028)">2028</button>
                <button class="year-btn" onclick="viewGrowthYear(2029)">2029</button>
                <button class="year-btn" onclick="viewGrowthYear(2030)">2030</button>
                <button class="year-btn" onclick="viewGrowthYear(2031)">2031</button>
            </div>

            <div class="grid-2">
                <div class="card">
                    <h4><i class="fas fa-users"></i> Membership Growth</h4>
                    <div class="graph-container">
                        <canvas id="membershipGrowthChart"></canvas>
                    </div>
                </div>
                <div class="card">
                    <h4><i class="fas fa-home"></i> Household Growth</h4>
                    <div class="graph-container">
                        <canvas id="householdGrowthChart"></canvas>
                    </div>
                </div>
            </div>

            <div class="grid-2">
                <div class="card">
                    <h4><i class="fas fa-money-bill-wave"></i> Tithing Growth</h4>
                    <div class="graph-container">
                        <canvas id="tithingGrowthChart"></canvas>
                    </div>
                </div>
                <div class="card">
                    <h4><i class="fas fa-graduation-cap"></i> Formation Participation</h4>
                    <div class="graph-container">
                        <canvas id="formationGrowthChart"></canvas>
                    </div>
                </div>
            </div>

            <h3 class="section-title">Yearly Growth Comparison</h3>
            <div class="card">
                <table id="growthComparisonTable">
                    <thead>
                        <tr>
                            <th>Metric</th>
                            <th>2026</th>
                            <th>2027</th>
                            <th>2028</th>
                            <th>2029</th>
                            <th>2030</th>
                            <th>2031</th>
                            <th>Total Growth</th>
                        </tr>
                    </thead>
                    <tbody id="growthComparison">
                        <!-- Growth comparison will be loaded here -->
                    </tbody>
                </table>
            </div>

            <h3 class="section-title">Area-wise Performance</h3>
            <div class="card">
                <table id="areaPerformanceTable">
                    <thead>
                        <tr>
                            <th>Area</th>
                            <th>Households</th>
                            <th>Members</th>
                            <th>2026 Tithes</th>
                            <th>2027 Tithes</th>
                            <th>Growth %</th>
                            <th>Formation Rate</th>
                        </tr>
                    </thead>
                    <tbody id="areaPerformance">
                        <!-- Area performance will be loaded here -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Reports Tab -->
        <div id="reports" class="tab-content">
            <h3 class="section-title">
                <i class="fas fa-file-alt"></i> Generate Reports
            </h3>

            <div class="grid-3">
                <div class="card">
                    <h4><i class="fas fa-users"></i> Membership Report</h4>
                    <p>Complete report of all SOLD members with details</p>
                    <button class="btn" onclick="generatePDFReport('membership')">
                        <i class="fas fa-file-pdf"></i> Generate PDF
                    </button>
                    <button class="btn btn-success" onclick="generateExcelReport('membership')">
                        <i class="fas fa-file-excel"></i> Generate Excel
                    </button>
                </div>
                <div class="card">
                    <h4><i class="fas fa-home"></i> Household Report</h4>
                    <p>Detailed report of all households and HPMs</p>
                    <button class="btn" onclick="generatePDFReport('households')">
                        <i class="fas fa-file-pdf"></i> Generate PDF
                    </button>
                    <button class="btn btn-success" onclick="generateExcelReport('households')">
                        <i class="fas fa-file-excel"></i> Generate Excel
                    </button>
                </div>
                <div class="card">
                    <h4><i class="fas fa-money-bill-wave"></i> Tithing Report</h4>
                    <p>Complete tithing records and financial summary</p>
                    <button class="btn" onclick="generatePDFReport('tithing')">
                        <i class="fas fa-file-pdf"></i> Generate PDF
                    </button>
                    <button class="btn btn-success" onclick="generateExcelReport('tithing')">
                        <i class="fas fa-file-excel"></i> Generate Excel
                    </button>
                </div>
                <div class="card">
                    <h4><i class="fas fa-graduation-cap"></i> Formation Report</h4>
                    <p>Formation program progress and attendance</p>
                    <button class="btn" onclick="generatePDFReport('formations')">
                        <i class="fas fa-file-pdf"></i> Generate PDF
                    </button>
                    <button class="btn btn-success" onclick="generateExcelReport('formations')">
                        <i class="fas fa-file-excel"></i> Generate Excel
                    </button>
                </div>
                <div class="card">
                    <h4><i class="fas fa-chart-line"></i> Growth Report</h4>
                    <p>Complete growth analysis 2026-2031</p>
                    <button class="btn" onclick="generatePDFReport('growth')">
                        <i class="fas fa-file-pdf"></i> Generate PDF
                    </button>
                    <button class="btn btn-success" onclick="generateExcelReport('growth')">
                        <i class="fas fa-file-excel"></i> Generate Excel
                    </button>
                </div>
                <div class="card">
                    <h4><i class="fas fa-images"></i> Activity Report</h4>
                    <p>Photo gallery and activity documentation</p>
                    <button class="btn" onclick="generatePDFReport('activities')">
                        <i class="fas fa-file-pdf"></i> Generate PDF
                    </button>
                    <button class="btn btn-success" onclick="generateExcelReport('activities')">
                        <i class="fas fa-file-excel"></i> Generate Excel
                    </button>
                </div>
            </div>

            <h3 class="section-title">Custom Report Generator</h3>
            <div class="card">
                <div class="grid-2">
                    <div class="form-group">
                        <label>Report Type</label>
                        <select class="form-control" id="reportType">
                            <option value="growth">Growth Analysis</option>
                            <option value="financial">Financial Summary</option>
                            <option value="attendance">Attendance Summary</option>
                            <option value="formation">Formation Progress</option>
                            <option value="area">Area Performance</option>
                            <option value="yearly">Yearly Summary</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Year Range</label>
                        <div style="display: flex; gap: 1rem;">
                            <select class="form-control" id="reportStartYear">
                                <option value="2026">2026</option>
                                <option value="2027">2027</option>
                                <option value="2028">2028</option>
                                <option value="2029">2029</option>
                                <option value="2030">2030</option>
                                <option value="2031">2031</option>
                            </select>
                            <select class="form-control" id="reportEndYear">
                                <option value="2026">2026</option>
                                <option value="2027">2027</option>
                                <option value="2028">2028</option>
                                <option value="2029" selected>2029</option>
                                <option value="2030">2030</option>
                                <option value="2031">2031</option>
                            </select>
                        </div>
                    </div>
                    <div class="form-group">
                        <label>Areas to Include</label>
                        <select class="form-control" id="reportAreas" multiple style="height: 100px;">
                        </select>
                    </div>
                    <div class="form-group">
                        <label>Report Format</label>
                        <select class="form-control" id="reportFormat">
                            <option value="pdf">PDF Document</option>
                            <option value="excel">Excel Spreadsheet</option>
                            <option value="csv">CSV File</option>
                        </select>
                    </div>
                </div>
                <div class="form-group">
                    <label>Include Sections</label>
                    <div style="display: flex; gap: 1rem; flex-wrap: wrap;">
                        <label style="display: flex; align-items: center; gap: 0.5rem;">
                            <input type="checkbox" id="includeLogo" checked> SOLD Logo & Header
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.5rem;">
                            <input type="checkbox" id="includeCharts" checked> Charts & Graphs
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.5rem;">
                            <input type="checkbox" id="includeSummary" checked> Executive Summary
                        </label>
                        <label style="display: flex; align-items: center; gap: 0.5rem;">
                            <input type="checkbox" id="includeDetails" checked> Detailed Data
                        </label>
                    </div>
                </div>
                <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
                    <button class="btn btn-success" onclick="generateCustomReport()">
                        <i class="fas fa-download"></i> Generate Custom Report
                    </button>
                </div>
            </div>

            <h3 class="section-title">Quick Reports</h3>
            <div class="grid">
                <div class="card">
                    <h4>Monthly Tithing Summary</h4>
                    <select class="form-control" style="margin: 0.5rem 0;" id="quickMonth">
                        <option value="">Select Month</option>
                        <option value="1">January</option>
                        <option value="2">February</option>
                        <option value="3">March</option>
                        <option value="4">April</option>
                        <option value="5">May</option>
                        <option value="6">June</option>
                        <option value="7">July</option>
                        <option value="8">August</option>
                        <option value="9">September</option>
                        <option value="10">October</option>
                        <option value="11">November</option>
                        <option value="12">December</option>
                    </select>
                    <select class="form-control" style="margin-bottom: 0.5rem;" id="quickYear">
                        <option value="2026">2026</option>
                        <option value="2027">2027</option>
                        <option value="2028">2028</option>
                        <option value="2029">2029</option>
                        <option value="2030">2030</option>
                        <option value="2031">2031</option>
                    </select>
                    <button class="btn btn-small" onclick="generateQuickReport()">
                        <i class="fas fa-download"></i> Download
                    </button>
                </div>
                <div class="card">
                    <h4>Area Performance Report</h4>
                    <select class="form-control" style="margin: 0.5rem 0;" id="quickArea">
                        <option value="">Select Area</option>
                    </select>
                    <button class="btn btn-small" onclick="generateAreaReport()">
                        <i class="fas fa-download"></i> Download
                    </button>
                </div>
                <div class="card">
                    <h4>Formation Attendance</h4>
                    <select class="form-control" style="margin: 0.5rem 0;" id="quickFormationYear">
                        <option value="2026">2026</option>
                        <option value="2027">2027</option>
                        <option value="2028">2028</option>
                        <option value="2029">2029</option>
                        <option value="2030">2030</option>
                        <option value="2031">2031</option>
                    </select>
                    <button class="btn btn-small" onclick="generateFormationReport()">
                        <i class="fas fa-download"></i> Download
                    </button>
                </div>
            </div>
        </div>

        <!-- Photo Gallery Tab -->
        <div id="gallery" class="tab-content">
            <h3 class="section-title">
                <i class="fas fa-images"></i> Activity Photo Gallery
                <button class="btn btn-success" onclick="openModal('addPhotoModal')">
                    <i class="fas fa-plus"></i> Add Photo
                </button>
            </h3>

            <div class="year-selector">
                <span>Filter by Year:</span>
                <button class="year-btn active" onclick="filterGallery('all')">All Years</button>
                <button class="year-btn" onclick="filterGallery(2026)">2026</button>
                <button class="year-btn" onclick="filterGallery(2027)">2027</button>
                <button class="year-btn" onclick="filterGallery(2028)">2028</button>
                <button class="year-btn" onclick="filterGallery(2029)">2029</button>
                <button class="year-btn" onclick="filterGallery(2030)">2030</button>
                <button class="year-btn" onclick="filterGallery(2031)">2031</button>
                <select class="form-control" style="width: 200px;" id="galleryAreaFilter" onchange="filterGallery('all')">
                    <option value="">All Areas</option>
                </select>
                <select class="form-control" style="width: 200px;" id="galleryActivityFilter" onchange="filterGallery('all')">
                    <option value="">All Activities</option>
                    <option value="formation">Formation</option>
                    <option value="hpm">HPM</option>
                    <option value="outreach">Outreach</option>
                    <option value="assembly">Assembly</option>
                </select>
            </div>

            <div class="photo-gallery" id="photoGallery">
                <!-- Photos will be loaded here -->
            </div>

            <h3 class="section-title">Photo Statistics</h3>
            <div class="stats-container">
                <div class="stat-card">
                    <div class="stat-label">Total Photos</div>
                    <div class="stat-value" id="totalPhotos">0</div>
                    <div>Documented</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Activities</div>
                    <div class="stat-value" id="totalActivities">0</div>
                    <div>With Photos</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">2026 Photos</div>
                    <div class="stat-value" id="photos2026">0</div>
                    <div>First Year</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Latest Photo</div>
                    <div class="stat-value" id="latestPhotoDate">-</div>
                    <div id="latestActivity">-</div>
                </div>
            </div>
        </div>

        <!-- Data Management Tab -->
        <div id="data" class="tab-content">
            <h3 class="section-title">
                <i class="fas fa-database"></i> Data Management
            </h3>

            <div class="grid-3">
                <div class="card">
                    <h4><i class="fas fa-download"></i> Export All Data</h4>
                    <p>Export all SOLD data as JSON file</p>
                    <button class="btn btn-success" onclick="exportAllData()">
                        <i class="fas fa-file-export"></i> Export JSON
                    </button>
                </div>
                <div class="card">
                    <h4><i class="fas fa-upload"></i> Import Data</h4>
                    <p>Import data from JSON file</p>
                    <input type="file" id="importFile" accept=".json" style="margin: 0.5rem 0;" onchange="handleFileSelect(event)">
                    <button class="btn" onclick="importData()">
                        <i class="fas fa-file-import"></i> Import JSON
                    </button>
                </div>
                <div class="card">
                    <h4><i class="fas fa-trash"></i> Clear All Data</h4>
                    <p>Warning: This will delete all data</p>
                    <button class="btn btn-danger" onclick="clearAllData()">
                        <i class="fas fa-trash-alt"></i> Clear All Data
                    </button>
                </div>
                <div class="card">
                    <h4><i class="fas fa-copy"></i> Backup Data</h4>
                    <p>Create a backup of current data</p>
                    <button class="btn btn-warning" onclick="createBackup()">
                        <i class="fas fa-save"></i> Create Backup
                    </button>
                </div>
                <div class="card">
                    <h4><i class="fas fa-redo"></i> Restore Backup</h4>
                    <p>Restore data from backup file</p>
                    <input type="file" id="restoreFile" accept=".json" style="margin: 0.5rem 0;" onchange="handleRestoreFile(event)">
                    <button class="btn btn-purple" onclick="restoreBackup()">
                        <i class="fas fa-history"></i> Restore Backup
                    </button>
                </div>
                <div class="card">
                    <h4><i class="fas fa-database"></i> Data Statistics</h4>
                    <div id="dataStats">
                        <!-- Data statistics will be loaded here -->
                    </div>
                </div>
            </div>

            <h3 class="section-title">Data Integrity Check</h3>
            <div class="card">
                <div class="form-group">
                    <button class="btn" onclick="checkDataIntegrity()">
                        <i class="fas fa-search"></i> Check Data Integrity
                    </button>
                    <button class="btn btn-success" onclick="fixDataIssues()" style="margin-left: 1rem;">
                        <i class="fas fa-wrench"></i> Fix Issues
                    </button>
                </div>
                <div id="integrityResults">
                    <!-- Integrity check results will be shown here -->
                </div>
            </div>

            <h3 class="section-title">Sample Data</h3>
            <div class="card">
                <p>Load sample data for testing and demonstration purposes:</p>
                <div class="data-management">
                    <button class="btn" onclick="loadSampleData()">
                        <i class="fas fa-vial"></i> Load Sample Data
                    </button>
                    <button class="btn btn-warning" onclick="generateTestData()">
                        <i class="fas fa-plus"></i> Generate Test Data
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Toast Notification -->
    <div id="toast" class="toast">
        <i class="fas fa-check-circle"></i>
        <span id="toastMessage">Operation completed successfully!</span>
    </div>

    <!-- Modals -->
    <div id="addHouseholdModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add New Household</h3>
                <button class="close-modal" onclick="closeModal('addHouseholdModal')">&times;</button>
            </div>
            <div class="grid-2">
                <div class="form-group">
                    <label>Household Name *</label>
                    <input type="text" class="form-control" id="householdName" required>
                </div>
                <div class="form-group">
                    <label>Area *</label>
                    <select class="form-control" id="householdArea" required>
                    </select>
                </div>
                <div class="form-group">
                    <label>Household Leader *</label>
                    <select class="form-control" id="householdLeader" required>
                        <option value="">Select Leader</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Meeting Day *</label>
                    <select class="form-control" id="meetingDay" required>
                        <option value="Sunday">Sunday</option>
                        <option value="Monday">Monday</option>
                        <option value="Tuesday">Tuesday</option>
                        <option value="Wednesday">Wednesday</option>
                        <option value="Thursday">Thursday</option>
                        <option value="Friday">Friday</option>
                        <option value="Saturday">Saturday</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Meeting Time</label>
                    <input type="time" class="form-control" id="meetingTime" value="19:00">
                </div>
                <div class="form-group">
                    <label>Residence Address *</label>
                    <textarea class="form-control" id="residenceAddress" rows="2" required></textarea>
                </div>
            </div>
            <div class="form-group">
                <label>Select Household Members</label>
                <div class="member-grid" id="householdMembersSelect">
                </div>
            </div>
            <div class="form-group">
                <label>Notes</label>
                <textarea class="form-control" id="householdNotes" rows="2"></textarea>
            </div>
            <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
                <button class="btn btn-success" onclick="saveHousehold()">
                    <i class="fas fa-save"></i> Save Household
                </button>
                <button class="btn" onclick="closeModal('addHouseholdModal')">
                    <i class="fas fa-times"></i> Cancel
                </button>
            </div>
        </div>
    </div>

    <div id="editHouseholdModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Edit Household</h3>
                <button class="close-modal" onclick="closeModal('editHouseholdModal')">&times;</button>
            </div>
            <input type="hidden" id="editHouseholdId">
            <div class="grid-2">
                <div class="form-group">
                    <label>Household Name *</label>
                    <input type="text" class="form-control" id="editHouseholdName" required>
                </div>
                <div class="form-group">
                    <label>Area *</label>
                    <select class="form-control" id="editHouseholdArea" required>
                    </select>
                </div>
                <div class="form-group">
                    <label>Household Leader *</label>
                    <select class="form-control" id="editHouseholdLeader" required>
                        <option value="">Select Leader</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Meeting Day *</label>
                    <select class="form-control" id="editMeetingDay" required>
                        <option value="Sunday">Sunday</option>
                        <option value="Monday">Monday</option>
                        <option value="Tuesday">Tuesday</option>
                        <option value="Wednesday">Wednesday</option>
                        <option value="Thursday">Thursday</option>
                        <option value="Friday">Friday</option>
                        <option value="Saturday">Saturday</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Meeting Time</label>
                    <input type="time" class="form-control" id="editMeetingTime" value="19:00">
                </div>
                <div class="form-group">
                    <label>Residence Address *</label>
                    <textarea class="form-control" id="editResidenceAddress" rows="2" required></textarea>
                </div>
            </div>
            <div class="form-group">
                <label>Select Household Members</label>
                <div class="member-grid" id="editHouseholdMembersSelect">
                </div>
            </div>
            <div class="form-group">
                <label>Notes</label>
                <textarea class="form-control" id="editHouseholdNotes" rows="2"></textarea>
            </div>
            <div class="form-group">
                <label>Status</label>
                <select class="form-control" id="editHouseholdStatus">
                    <option value="active">Active</option>
                    <option value="inactive">Inactive</option>
                </select>
            </div>
            <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
                <button class="btn btn-success" onclick="updateHousehold()">
                    <i class="fas fa-save"></i> Update Household
                </button>
                <button class="btn btn-danger" onclick="deleteHousehold()">
                    <i class="fas fa-trash"></i> Delete
                </button>
                <button class="btn" onclick="closeModal('editHouseholdModal')">
                    <i class="fas fa-times"></i> Cancel
                </button>
            </div>
        </div>
    </div>

    <div id="addMemberModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add New SOLD Member</h3>
                <button class="close-modal" onclick="closeModal('addMemberModal')">&times;</button>
            </div>
            <div class="grid-2">
                <div class="form-group">
                    <label>Full Name *</label>
                    <input type="text" class="form-control" id="memberName" required>
                </div>
                <div class="form-group">
                    <label>Birthday *</label>
                    <input type="date" class="form-control" id="memberBirthday" required>
                </div>
                <div class="form-group">
                    <label>Contact Number</label>
                    <input type="tel" class="form-control" id="memberContact">
                </div>
                <div class="form-group">
                    <label>Email Address</label>
                    <input type="email" class="form-control" id="memberEmail">
                </div>
                <div class="form-group">
                    <label>Area *</label>
                    <select class="form-control" id="memberArea" required>
                    </select>
                </div>
                <div class="form-group">
                    <label>Household</label>
                    <select class="form-control" id="memberHousehold">
                        <option value="">Not Assigned</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Work/Occupation</label>
                    <input type="text" class="form-control" id="memberWork">
                </div>
                <div class="form-group">
                    <label>Functionality in SOLD</label>
                    <select class="form-control" id="memberFunctionality">
                        <option value="member">Regular Member</option>
                        <option value="hpm_leader">Household Leader</option>
                        <option value="area_coordinator">Area Coordinator</option>
                        <option value="formation_speaker">Formation Speaker</option>
                        <option value="worship_leader">Worship Leader</option>
                        <option value="outreach_leader">Outreach Leader</option>
                        <option value="youth_leader">Youth Leader</option>
                        <option value="pcc_Leyte">PCC</option>
                        <option value="unit_head">Unit Head</option>
                        <option value="chapter_head">Chapter Head</option>
                        <option value="sector_head">Sector Head</option>

                    </select>
                </div>
                <div class="form-group">
                    <label>Member Since *</label>
                    <input type="date" class="form-control" id="memberSince" required>
                </div>
                <div class="form-group">
                    <label>Status</label>
                    <select class="form-control" id="memberStatus">
                        <option value="active">Active</option>
                        <option value="inactive">Inactive</option>
                        <option value="transferred">Transferred</option>
                    </select>
                </div>
            </div>
            <div class="form-group">
                <label>Address</label>
                <textarea class="form-control" id="memberAddress" rows="2"></textarea>
            </div>
            <div class="form-group">
                <label>Notes/Remarks</label>
                <textarea class="form-control" id="memberNotes" rows="3"></textarea>
            </div>
            <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
                <button class="btn btn-success" onclick="saveMember()">
                    <i class="fas fa-save"></i> Save Member
                </button>
                <button class="btn" onclick="closeModal('addMemberModal')">
                    <i class="fas fa-times"></i> Cancel
                </button>
            </div>
        </div>
    </div>

    <div id="editMemberModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Edit SOLD Member</h3>
                <button class="close-modal" onclick="closeModal('editMemberModal')">&times;</button>
            </div>
            <input type="hidden" id="editMemberId">
            <div class="grid-2">
                <div class="form-group">
                    <label>Full Name *</label>
                    <input type="text" class="form-control" id="editMemberName" required>
                </div>
                <div class="form-group">
                    <label>Birthday *</label>
                    <input type="date" class="form-control" id="editMemberBirthday" required>
                </div>
                <div class="form-group">
                    <label>Contact Number</label>
                    <input type="tel" class="form-control" id="editMemberContact">
                </div>
                <div class="form-group">
                    <label>Email Address</label>
                    <input type="email" class="form-control" id="editMemberEmail">
                </div>
                <div class="form-group">
                    <label>Area *</label>
                    <select class="form-control" id="editMemberArea" required>
                    </select>
                </div>
                <div class="form-group">
                    <label>Household</label>
                    <select class="form-control" id="editMemberHousehold">
                        <option value="">Not Assigned</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Work/Occupation</label>
                    <input type="text" class="form-control" id="editMemberWork">
                </div>
                <div class="form-group">
                    <label>Functionality in SOLD</label>
                    <select class="form-control" id="editMemberFunctionality">
                        <option value="member">Regular Member</option>
                        <option value="hpm_leader">HPM Leader</option>
                        <option value="area_coordinator">Area Coordinator</option>
                        <option value="formation_speaker">Formation Speaker</option>
                        <option value="worship_leader">Worship Leader</option>
                        <option value="outreach_leader">Outreach Leader</option>
                        <option value="youth_leader">Youth Leader</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Member Since *</label>
                    <input type="date" class="form-control" id="editMemberSince" required>
                </div>
                <div class="form-group">
                    <label>Status</label>
                    <select class="form-control" id="editMemberStatus">
                        <option value="active">Active</option>
                        <option value="inactive">Inactive</option>
                        <option value="transferred">Transferred</option>
                    </select>
                </div>
            </div>
            <div class="form-group">
                <label>Address</label>
                <textarea class="form-control" id="editMemberAddress" rows="2"></textarea>
            </div>
            <div class="form-group">
                <label>Notes/Remarks</label>
                <textarea class="form-control" id="editMemberNotes" rows="3"></textarea>
            </div>
            <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
                <button class="btn btn-success" onclick="updateMember()">
                    <i class="fas fa-save"></i> Update Member
                </button>
                <button class="btn btn-danger" onclick="deleteMember()">
                    <i class="fas fa-trash"></i> Delete
                </button>
                <button class="btn" onclick="closeModal('editMemberModal')">
                    <i class="fas fa-times"></i> Cancel
                </button>
            </div>
        </div>
    </div>

    <div id="addFormationModal" class="modal">
        <div class="modal-content modal-lg">
            <div class="modal-header">
                <h3>Schedule Formation Talk</h3>
                <button class="close-modal" onclick="closeModal('addFormationModal')">&times;</button>
            </div>
            <div class="grid-2">
                <div class="form-group">
                    <label>Talk Topic *</label>
                    <input type="text" class="form-control" id="formationTopic" required>
                </div>
                <div class="form-group">
                    <label>Speaker *</label>
                    <input type="text" class="form-control" id="formationSpeaker" required>
                </div>
                <div class="form-group">
                    <label>Date *</label>
                    <input type="date" class="form-control" id="formationDate" required>
                </div>
                <div class="form-group">
                    <label>Time *</label>
                    <input type="time" class="form-control" id="formationTime" required value="14:00">
                </div>
                <div class="form-group">
                    <label>Area/Location *</label>
                    <select class="form-control" id="formationLocation" required onchange="loadAreaMembers()">
                    </select>
                </div>
                <div class="form-group">
                    <label>Year Program</label>
                    <select class="form-control" id="formationYearProgram">
                        <option value="1">Year 1: Foundation (2026)</option>
                        <option value="2">Year 2: Growth (2027)</option>
                        <option value="3">Year 3: Mission (2028)</option>
                        <option value="4">Year 4: Leadership (2029)</option>
                        <option value="5">Year 5: Advanced (2030)</option>
                        <option value="6">Year 6: Mastery (2031)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Venue *</label>
                    <input type="text" class="form-control" id="formationVenue" required>
                </div>
                <div class="form-group">
                    <label>Duration (hours)</label>
                    <input type="number" class="form-control" id="formationDuration" min="1" max="8" value="2">
                </div>
            </div>
            <div class="form-group">
                <label>Talk Description</label>
                <textarea class="form-control" id="formationDescription" rows="3"></textarea>
            </div>
            <div class="form-group">
                <label>Select Attendees from <span id="selectedAreaName">Selected Area</span></label>
                <div class="member-grid" id="formationAttendeesSelect">
                </div>
                <div style="margin-top: 1rem; padding: 1rem; background: #f8f9fa; border-radius: 6px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span><strong>Selected:</strong> <span id="selectedCount">0</span> members</span>
                        <button type="button" class="btn btn-small" onclick="selectAllMembers()">
                            <i class="fas fa-check-square"></i> Select All
                        </button>
                        <button type="button" class="btn btn-small" onclick="deselectAllMembers()">
                            <i class="fas fa-times-circle"></i> Deselect All
                        </button>
                    </div>
                </div>
            </div>
            <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
                <button class="btn btn-success" onclick="saveFormation()">
                    <i class="fas fa-save"></i> Schedule Talk
                </button>
                <button class="btn" onclick="closeModal('addFormationModal')">
                    <i class="fas fa-times"></i> Cancel
                </button>
            </div>
        </div>
    </div>

    <div id="editFormationModal" class="modal">
        <div class="modal-content modal-lg">
            <div class="modal-header">
                <h3>Edit Formation Talk</h3>
                <button class="close-modal" onclick="closeModal('editFormationModal')">&times;</button>
            </div>
            <input type="hidden" id="editFormationId">
            <div class="grid-2">
                <div class="form-group">
                    <label>Talk Topic *</label>
                    <input type="text" class="form-control" id="editFormationTopic" required>
                </div>
                <div class="form-group">
                    <label>Speaker *</label>
                    <input type="text" class="form-control" id="editFormationSpeaker" required>
                </div>
                <div class="form-group">
                    <label>Date *</label>
                    <input type="date" class="form-control" id="editFormationDate" required>
                </div>
                <div class="form-group">
                    <label>Time *</label>
                    <input type="time" class="form-control" id="editFormationTime" required value="14:00">
                </div>
                <div class="form-group">
                    <label>Area/Location *</label>
                    <select class="form-control" id="editFormationLocation" required onchange="loadEditAreaMembers()">
                    </select>
                </div>
                <div class="form-group">
                    <label>Year Program</label>
                    <select class="form-control" id="editFormationYearProgram">
                        <option value="1">Year 1: Foundation (2026)</option>
                        <option value="2">Year 2: Growth (2027)</option>
                        <option value="3">Year 3: Mission (2028)</option>
                        <option value="4">Year 4: Leadership (2029)</option>
                        <option value="5">Year 5: Advanced (2030)</option>
                        <option value="6">Year 6: Mastery (2031)</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Venue *</label>
                    <input type="text" class="form-control" id="editFormationVenue" required>
                </div>
                <div class="form-group">
                    <label>Duration (hours)</label>
                    <input type="number" class="form-control" id="editFormationDuration" min="1" max="8" value="2">
                </div>
            </div>
            <div class="form-group">
                <label>Talk Description</label>
                <textarea class="form-control" id="editFormationDescription" rows="3"></textarea>
            </div>
            <div class="form-group">
                <label>Select Attendees from <span id="editSelectedAreaName">Selected Area</span></label>
                <div class="member-grid" id="editFormationAttendeesSelect">
                </div>
                <div style="margin-top: 1rem; padding: 1rem; background: #f8f9fa; border-radius: 6px;">
                    <div style="display: flex; justify-content: space-between; align-items: center;">
                        <span><strong>Selected:</strong> <span id="editSelectedCount">0</span> members</span>
                        <button type="button" class="btn btn-small" onclick="selectAllEditMembers()">
                            <i class="fas fa-check-square"></i> Select All
                        </button>
                        <button type="button" class="btn btn-small" onclick="deselectAllEditMembers()">
                            <i class="fas fa-times-circle"></i> Deselect All
                        </button>
                    </div>
                </div>
            </div>
            <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
                <button class="btn btn-success" onclick="updateFormation()">
                    <i class="fas fa-save"></i> Update Talk
                </button>
                <button class="btn btn-danger" onclick="deleteFormation()">
                    <i class="fas fa-trash"></i> Delete
                </button>
                <button class="btn" onclick="closeModal('editFormationModal')">
                    <i class="fas fa-times"></i> Cancel
                </button>
            </div>
        </div>
    </div>

    <div id="recordTitheModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Record Tithe Contribution</h3>
                <button class="close-modal" onclick="closeModal('recordTitheModal')">&times;</button>
            </div>
            <div class="grid-2">
                <div class="form-group">
                    <label>Member *</label>
                    <select class="form-control" id="titheMember" required onchange="updateMemberArea()">
                        <option value="">Select Member</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Member Area</label>
                    <input type="text" class="form-control" id="titheMemberArea" readonly>
                </div>
                <div class="form-group">
                    <label>Amount (₱) *</label>
                    <input type="number" class="form-control" id="titheAmount" step="0.01" min="0" required>
                </div>
                <div class="form-group">
                    <label>Date *</label>
                    <input type="date" class="form-control" id="titheDate" required>
                </div>
                <div class="form-group">
                    <label>Type</label>
                    <select class="form-control" id="titheType">
                        <option value="regular">Regular Tithe</option>
                        <option value="special">Special Offering</option>
                        <option value="thanksgiving">Thanksgiving</option>
                        <option value="pledge">Pledge Fulfillment</option>
                        <option value="mission">Mission Fund</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Payment Method</label>
                    <select class="form-control" id="titheMethod">
                        <option value="cash">Cash</option>
                        <option value="bank">Bank Transfer</option>
                        <option value="gcash">GCash</option>
                        <option value="maya">Maya</option>
                        <option value="check">Check</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Reference/Receipt #</label>
                    <input type="text" class="form-control" id="titheReference">
                </div>
                <div class="form-group">
                    <label>Month/Year</label>
                    <div style="display: flex; gap: 0.5rem;">
                        <select class="form-control" id="titheMonth">
                            <option value="1">January</option>
                            <option value="2">February</option>
                            <option value="3">March</option>
                            <option value="4">April</option>
                            <option value="5">May</option>
                            <option value="6">June</option>
                            <option value="7">July</option>
                            <option value="8">August</option>
                            <option value="9">September</option>
                            <option value="10">October</option>
                            <option value="11">November</option>
                            <option value="12">December</option>
                        </select>
                        <select class="form-control" id="titheYear">
                            <option value="2026">2026</option>
                            <option value="2027">2027</option>
                            <option value="2028">2028</option>
                            <option value="2029">2029</option>
                            <option value="2030">2030</option>
                            <option value="2031">2031</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="form-group">
                <label>Notes</label>
                <textarea class="form-control" id="titheNotes" rows="2"></textarea>
            </div>
            <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
                <button class="btn btn-success" onclick="saveTithe()">
                    <i class="fas fa-save"></i> Save Tithe
                </button>
                <button class="btn" onclick="closeModal('recordTitheModal')">
                    <i class="fas fa-times"></i> Cancel
                </button>
            </div>
        </div>
    </div>

    <div id="editTitheModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Edit Tithe Contribution</h3>
                <button class="close-modal" onclick="closeModal('editTitheModal')">&times;</button>
            </div>
            <input type="hidden" id="editTitheId">
            <div class="grid-2">
                <div class="form-group">
                    <label>Member *</label>
                    <select class="form-control" id="editTitheMember" required onchange="updateEditMemberArea()">
                        <option value="">Select Member</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Member Area</label>
                    <input type="text" class="form-control" id="editTitheMemberArea" readonly>
                </div>
                <div class="form-group">
                    <label>Amount (₱) *</label>
                    <input type="number" class="form-control" id="editTitheAmount" step="0.01" min="0" required>
                </div>
                <div class="form-group">
                    <label>Date *</label>
                    <input type="date" class="form-control" id="editTitheDate" required>
                </div>
                <div class="form-group">
                    <label>Type</label>
                    <select class="form-control" id="editTitheType">
                        <option value="regular">Regular Tithe</option>
                        <option value="special">Special Offering</option>
                        <option value="thanksgiving">Thanksgiving</option>
                        <option value="pledge">Pledge Fulfillment</option>
                        <option value="mission">Mission Fund</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Payment Method</label>
                    <select class="form-control" id="editTitheMethod">
                        <option value="cash">Cash</option>
                        <option value="bank">Bank Transfer</option>
                        <option value="gcash">GCash</option>
                        <option value="maya">Maya</option>
                        <option value="check">Check</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Reference/Receipt #</label>
                    <input type="text" class="form-control" id="editTitheReference">
                </div>
                <div class="form-group">
                    <label>Month/Year</label>
                    <div style="display: flex; gap: 0.5rem;">
                        <select class="form-control" id="editTitheMonth">
                            <option value="1">January</option>
                            <option value="2">February</option>
                            <option value="3">March</option>
                            <option value="4">April</option>
                            <option value="5">May</option>
                            <option value="6">June</option>
                            <option value="7">July</option>
                            <option value="8">August</option>
                            <option value="9">September</option>
                            <option value="10">October</option>
                            <option value="11">November</option>
                            <option value="12">December</option>
                        </select>
                        <select class="form-control" id="editTitheYear">
                            <option value="2026">2026</option>
                            <option value="2027">2027</option>
                            <option value="2028">2028</option>
                            <option value="2029">2029</option>
                            <option value="2030">2030</option>
                            <option value="2031">2031</option>
                        </select>
                    </div>
                </div>
            </div>
            <div class="form-group">
                <label>Notes</label>
                <textarea class="form-control" id="editTitheNotes" rows="2"></textarea>
            </div>
            <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
                <button class="btn btn-success" onclick="updateTithe()">
                    <i class="fas fa-save"></i> Update Tithe
                </button>
                <button class="btn btn-danger" onclick="deleteTithe()">
                    <i class="fas fa-trash"></i> Delete
                </button>
                <button class="btn" onclick="closeModal('editTitheModal')">
                    <i class="fas fa-times"></i> Cancel
                </button>
            </div>
        </div>
    </div>

    <div id="addPhotoModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Add Activity Photo</h3>
                <button class="close-modal" onclick="closeModal('addPhotoModal')">&times;</button>
            </div>
            <div class="grid-2">
                <div class="form-group">
                    <label>Activity Name *</label>
                    <input type="text" class="form-control" id="photoActivity" required>
                </div>
                <div class="form-group">
                    <label>Activity Type *</label>
                    <select class="form-control" id="photoActivityType" required>
                        <option value="formation">Formation Talk</option>
                        <option value="hpm">Household Prayer Meeting</option>
                        <option value="outreach">Outreach Activity</option>
                        <option value="assembly">General Assembly</option>
                        <option value="service">Service Activity</option>
                        <option value="training">Training Session</option>
                        <option value="fellowship">Fellowship</option>
                        <option value="clp">Christian Life Program</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Date *</label>
                    <input type="date" class="form-control" id="photoDate" required>
                </div>
                <div class="form-group">
                    <label>Area *</label>
                    <select class="form-control" id="photoArea" required>
                    </select>
                </div>
                <div class="form-group">
                    <label>Venue *</label>
                    <input type="text" class="form-control" id="photoVenue" required>
                </div>
                <div class="form-group">
                    <label>Number of Attendees</label>
                    <input type="number" class="form-control" id="photoAttendees" min="1">
                </div>
                <div class="form-group">
                    <label>Upload Photo</label>
                    <input type="file" class="form-control" id="photoFile" accept="image/*">
                    <small style="color: #666;">Note: Photos are stored as data URLs in your browser. For large collections, consider external storage.</small>
                </div>
                <div class="form-group">
                    <label>Photo Preview</label>
                    <div id="photoPreview" style="width: 100%; height: 150px; border: 2px dashed #ddd; border-radius: 6px; display: flex; justify-content: center; align-items: center; color: #666;">
                        <i class="fas fa-image" style="font-size: 3rem; opacity: 0.3;"></i>
                    </div>
                </div>
            </div>
            <div class="form-group">
                <label>Photo Description</label>
                <textarea class="form-control" id="photoDescription" rows="3" placeholder="Describe the activity, key moments, important people in the photo..."></textarea>
            </div>
            <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
                <button class="btn btn-success" onclick="savePhoto()">
                    <i class="fas fa-save"></i> Save Photo
                </button>
                <button class="btn" onclick="closeModal('addPhotoModal')">
                    <i class="fas fa-times"></i> Cancel
                </button>
            </div>
        </div>
    </div>

    <div class="footer">
        <p style="font-size: 1rem; font-weight: 600; color: var(--sold-blue); margin-bottom: 0.5rem;">
            Servants of the Lord (SOLD) - Leyte Province Growth Management System 2026-2031
        </p>
        <p style="font-size: 1rem; font-weight: 600; color: var(--sold-blue); margin-bottom: 0.5rem;">
            Coded by: Andriane Yap | BOSbyJecko | 01-05-2026
        </p>
        <p style="margin-bottom: 0.5rem; font-size: 0.9rem;">
            "And let us consider how we may spur one another on toward love and good deeds..." - Hebrews 10:24
        </p>
        <p style="color: #888; font-size: 0.8rem;">
            System initialized for 6-year growth tracking: 2026-2031 | All data is stored locally in your browser
        </p>
    </div>

    <!-- Hidden Print Section -->
    <div id="printSection" class="print-section" style="display: none;"></div>

    <script>
        // Complete Leyte Province Areas
        const LEYTE_AREAS = {
            'central': 'CENTRAL',
            'north': 'NORTH',
            'east': 'EAST',
            'west': 'WEST',
            'south': 'SOUTH',
            
        };

        // Complete 3-Year Formation Program Topics (2026-2029)
        const FORMATION_TOPICS = {
            2026: [
                "The Call to Servanthood",
                "Understanding Our Mission",
                "Spiritual Growth Fundamentals",
                "Prayer Life Development",
                "Scripture Study Methods",
                "Building Christian Character",
                "Servant Leadership Principles",
                "Evangelization Basics",
                "Community Building",
                "Personal Holiness"
            ],
            2027: [
                "Advanced Spiritual Warfare",
                "Mentoring and Discipleship",
                "Building Strong Families",
                "Financial Stewardship",
                "Ministry Management",
                "Advanced Prayer Techniques",
                "Biblical Leadership Models",
                "Church History for Servants",
                "Social Justice Ministry",
                "Youth Ministry Development"
            ],
            2028: [
                "Missionary Leadership",
                "Advanced Evangelization",
                "Church Planting Principles",
                "Cross-Cultural Ministry",
                "Advanced Formation Methods",
                "Strategic Planning in Ministry",
                "Crisis Management in Community",
                "Legacy Building",
                "Mastering Spiritual Gifts",
                "Final Commissioning"
            ],
            2029: [
                "Leadership Sustainability",
                "Advanced Community Development",
                "Mentoring the Next Generation",
                "Strategic Growth Planning",
                "Advanced Resource Management",
                "Innovation in Ministry",
                "Global Mission Perspective",
                "Legacy and Succession",
                "Advanced Theological Reflection",
                "Vision Casting for Future"
            ],
            2030: [
                "Mastering Discipleship",
                "Advanced Pastoral Care",
                "Strategic Evangelization",
                "Church Growth Principles",
                "Leadership Excellence",
                "Advanced Formation Leadership",
                "Community Transformation",
                "Sustainable Ministry Models",
                "Advanced Mission Strategy",
                "Kingdom Building"
            ],
            2031: [
                "Visionary Leadership",
                "Advanced Strategic Planning",
                "Global Impact Ministry",
                "Legacy Leadership",
                "Mastering Multiplication",
                "Advanced Church Development",
                "Future Trends in Ministry",
                "Excellence in Service",
                "Final Commissioning & Sending",
                "Celebrating the Journey"
            ]
        };

        // Data Manager Class
        class SOLDGrowthManager {
            constructor() {
                this.currentYear = new Date().getFullYear();
                this.initData();
                this.loadData();
            }

            initData() {
                if (!localStorage.getItem('sold_init')) {
                    this.members = [];
                    this.households = [];
                    this.tithes = [];
                    this.formations = [];
                    this.photos = [];
                    this.activities = [];
                    this.saveAllData();
                    localStorage.setItem('sold_init', 'true');
                    this.showToast('System initialized successfully!', 'success');
                }
            }

            loadData() {
                try {
                    this.members = JSON.parse(localStorage.getItem('sold_members')) || [];
                    this.households = JSON.parse(localStorage.getItem('sold_households')) || [];
                    this.tithes = JSON.parse(localStorage.getItem('sold_tithes')) || [];
                    this.formations = JSON.parse(localStorage.getItem('sold_formations')) || [];
                    this.photos = JSON.parse(localStorage.getItem('sold_photos')) || [];
                    this.activities = JSON.parse(localStorage.getItem('sold_activities')) || [];
                    
                    if (this.members.length === 0) {
                        this.initSampleData();
                    }
                } catch (error) {
                    console.error('Error loading data:', error);
                    this.showToast('Error loading data. Resetting to default.', 'error');
                    this.initSampleData();
                }
            }

            initSampleData() {
                // Sample members
                this.members = [
                    {
                        id: 1,
                        name: "Juan Dela Cruz",
                        birthday: "1975-03-15",
                        contact: "09171234567",
                        email: "juan@example.com",
                        area: "tacloban",
                        household: null,
                        work: "Government Employee",
                        functionality: "hpm_leader",
                        memberSince: "2026-01-15",
                        status: "active",
                        address: "123 Tacloban City",
                        notes: "Dedicated servant, good leader",
                        createdAt: new Date().toISOString()
                    },
                    {
                        id: 2,
                        name: "Maria Santos",
                        birthday: "1980-08-22",
                        contact: "09172223344",
                        email: "maria@example.com",
                        area: "ormoc",
                        household: null,
                        work: "Teacher",
                        functionality: "area_coordinator",
                        memberSince: "2026-02-10",
                        status: "active",
                        address: "456 Ormoc City",
                        notes: "Active in formations",
                        createdAt: new Date().toISOString()
                    }
                ];

                // Sample households
                this.households = [
                    {
                        id: 1,
                        name: "St. Joseph HPM",
                        area: "tacloban",
                        leaderId: 1,
                        leaderName: "Juan Dela Cruz",
                        meetingDay: "Tuesday",
                        meetingTime: "19:00",
                        residence: "123 Tacloban City",
                        members: [1],
                        notes: "Weekly HPM, active group",
                        status: "active",
                        created: "2026-01-20",
                        createdAt: new Date().toISOString()
                    }
                ];

                // Sample tithes
                this.tithes = [
                    {
                        id: 1,
                        memberId: 1,
                        memberName: "Juan Dela Cruz",
                        amount: 2000,
                        date: "2026-01-15",
                        type: "regular",
                        method: "cash",
                        reference: "T001-2026",
                        area: "tacloban",
                        month: 1,
                        year: 2026,
                        notes: "First tithe of 2026",
                        createdAt: new Date().toISOString()
                    }
                ];

                // Sample formations
                this.formations = [
                    {
                        id: 1,
                        topic: "The Call to Servanthood",
                        speaker: "Fr. Mario Santos",
                        date: "2026-01-20",
                        time: "14:00",
                        location: "tacloban",
                        venue: "St. Michael Parish",
                        duration: 2,
                        yearProgram: "1",
                        description: "Understanding the call to serve in SOLD",
                        attendees: [1, 2],
                        status: "completed",
                        totalAttendees: 2,
                        createdAt: new Date().toISOString()
                    }
                ];

                // Sample photos
                this.photos = [
                    {
                        id: 1,
                        activity: "First Formation Talk 2026",
                        activityType: "formation",
                        date: "2026-01-20",
                        area: "tacloban",
                        venue: "St. Michael Parish",
                        attendees: 25,
                        description: "First formation talk for Year 1 program",
                        photoData: "data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDIwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjIwMCIgaGVpZ2h0PSIyMDAiIGZpbGw9IiMxYTIzN2UiLz48dGV4dCB4PSI1MCUiIHk9IjUwJSIgZG9taW5hbnQtYmFzZWxpbmU9Im1pZGRsZSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZmlsbD0iI0ZGRkZGRiIgZm9udC1zaXplPSIyNCI+Rk9STUFUSU9OPC90ZXh0Pjwvc3ZnPg==",
                        year: 2026,
                        createdAt: new Date().toISOString()
                    }
                ];

                // Sample activities
                this.activities = [
                    {
                        id: 1,
                        type: "formation",
                        description: "First Formation Talk: The Call to Servanthood",
                        date: "2026-01-20",
                        area: "tacloban",
                        attendees: 25,
                        status: "completed",
                        createdAt: new Date().toISOString()
                    }
                ];

                this.saveAllData();
                this.showToast('Sample data loaded successfully!', 'success');
            }

            saveAllData() {
                try {
                    localStorage.setItem('sold_members', JSON.stringify(this.members));
                    localStorage.setItem('sold_households', JSON.stringify(this.households));
                    localStorage.setItem('sold_tithes', JSON.stringify(this.tithes));
                    localStorage.setItem('sold_formations', JSON.stringify(this.formations));
                    localStorage.setItem('sold_photos', JSON.stringify(this.photos));
                    localStorage.setItem('sold_activities', JSON.stringify(this.activities));
                } catch (error) {
                    console.error('Error saving data:', error);
                    this.showToast('Error saving data to storage', 'error');
                }
            }

            // Member methods
            addMember(member) {
                const newId = this.members.length > 0 ? Math.max(...this.members.map(m => m.id)) + 1 : 1;
                member.id = newId;
                member.createdAt = new Date().toISOString();
                this.members.push(member);
                this.saveAllData();
                
                this.logActivity({
                    type: "member",
                    description: `New member added: ${member.name}`,
                    date: new Date().toISOString().split('T')[0],
                    area: member.area
                });
                
                return member;
            }

            updateMember(id, updates) {
                const index = this.members.findIndex(m => m.id === id);
                if (index !== -1) {
                    this.members[index] = { ...this.members[index], ...updates };
                    this.saveAllData();
                    return true;
                }
                return false;
            }

            deleteMember(id) {
                this.members = this.members.filter(m => m.id !== id);
                this.saveAllData();
                return true;
            }

            getMember(id) {
                return this.members.find(m => m.id === id);
            }

            // Household methods
            addHousehold(household) {
                const newId = this.households.length > 0 ? Math.max(...this.households.map(h => h.id)) + 1 : 1;
                household.id = newId;
                household.created = new Date().toISOString().split('T')[0];
                household.createdAt = new Date().toISOString();
                this.households.push(household);
                this.saveAllData();
                
                this.logActivity({
                    type: "household",
                    description: `New household created: ${household.name}`,
                    date: new Date().toISOString().split('T')[0],
                    area: household.area
                });
                
                return household;
            }

            updateHousehold(id, updates) {
                const index = this.households.findIndex(h => h.id === id);
                if (index !== -1) {
                    this.households[index] = { ...this.households[index], ...updates };
                    this.saveAllData();
                    return true;
                }
                return false;
            }

            deleteHousehold(id) {
                this.households = this.households.filter(h => h.id !== id);
                this.saveAllData();
                return true;
            }

            getHousehold(id) {
                return this.households.find(h => h.id === id);
            }

            // Tithe methods
            addTithe(tithe) {
                const newId = this.tithes.length > 0 ? Math.max(...this.tithes.map(t => t.id)) + 1 : 1;
                tithe.id = newId;
                tithe.createdAt = new Date().toISOString();
                this.tithes.push(tithe);
                this.saveAllData();
                
                this.logActivity({
                    type: "tithe",
                    description: `${tithe.memberName} contributed ₱${tithe.amount.toLocaleString()}`,
                    date: tithe.date,
                    area: tithe.area,
                    amount: tithe.amount
                });
                
                return tithe;
            }

            updateTithe(id, updates) {
                const index = this.tithes.findIndex(t => t.id === id);
                if (index !== -1) {
                    this.tithes[index] = { ...this.tithes[index], ...updates };
                    this.saveAllData();
                    return true;
                }
                return false;
            }

            deleteTithe(id) {
                this.tithes = this.tithes.filter(t => t.id !== id);
                this.saveAllData();
                return true;
            }

            getTithe(id) {
                return this.tithes.find(t => t.id === id);
            }

            // Formation methods
            addFormation(formation) {
                const newId = this.formations.length > 0 ? Math.max(...this.formations.map(f => f.id)) + 1 : 1;
                formation.id = newId;
                formation.status = new Date(formation.date) >= new Date() ? 'upcoming' : 'completed';
                formation.totalAttendees = formation.attendees.length;
                formation.createdAt = new Date().toISOString();
                this.formations.push(formation);
                this.saveAllData();
                
                this.logActivity({
                    type: "formation",
                    description: `Formation talk scheduled: ${formation.topic}`,
                    date: formation.date,
                    area: formation.location,
                    attendees: formation.totalAttendees
                });
                
                return formation;
            }

            updateFormation(id, updates) {
                const index = this.formations.findIndex(f => f.id === id);
                if (index !== -1) {
                    updates.status = new Date(updates.date) >= new Date() ? 'upcoming' : 'completed';
                    updates.totalAttendees = updates.attendees.length;
                    this.formations[index] = { ...this.formations[index], ...updates };
                    this.saveAllData();
                    return true;
                }
                return false;
            }

            deleteFormation(id) {
                this.formations = this.formations.filter(f => f.id !== id);
                this.saveAllData();
                return true;
            }

            getFormation(id) {
                return this.formations.find(f => f.id === id);
            }

            // Photo methods
            addPhoto(photo) {
                const newId = this.photos.length > 0 ? Math.max(...this.photos.map(p => p.id)) + 1 : 1;
                photo.id = newId;
                photo.year = new Date(photo.date).getFullYear();
                photo.createdAt = new Date().toISOString();
                this.photos.push(photo);
                this.saveAllData();
                
                this.logActivity({
                    type: "photo",
                    description: `Photo added for activity: ${photo.activity}`,
                    date: photo.date,
                    area: photo.area,
                    attendees: photo.attendees
                });
                
                return photo;
            }

            updatePhoto(id, updates) {
                const index = this.photos.findIndex(p => p.id === id);
                if (index !== -1) {
                    this.photos[index] = { ...this.photos[index], ...updates };
                    this.saveAllData();
                    return true;
                }
                return false;
            }

            deletePhoto(id) {
                this.photos = this.photos.filter(p => p.id !== id);
                this.saveAllData();
                return true;
            }

            getPhoto(id) {
                return this.photos.find(p => p.id === id);
            }

            // Activity logging
            logActivity(activity) {
                const newId = this.activities.length > 0 ? Math.max(...this.activities.map(a => a.id)) + 1 : 1;
                activity.id = newId;
                activity.createdAt = new Date().toISOString();
                this.activities.push(activity);
                this.saveAllData();
            }

            // Get statistics
            getStats(year = null) {
                const targetYear = year || this.currentYear;
                
                const membersThisYear = this.members.filter(m => 
                    new Date(m.memberSince).getFullYear() <= targetYear && m.status === 'active'
                );
                
                const householdsThisYear = this.households.filter(h => 
                    new Date(h.created).getFullYear() <= targetYear && h.status === 'active'
                );
                
                const tithesThisYear = this.tithes.filter(t => t.year === targetYear);
                const tithesTotal = tithesThisYear.reduce((sum, t) => sum + t.amount, 0);
                
                const formationsThisYear = this.formations.filter(f => 
                    new Date(f.date).getFullYear() === targetYear
                );
                
                const photosThisYear = this.photos.filter(p => p.year === targetYear);
                
                return {
                    members: membersThisYear.length,
                    households: householdsThisYear.length,
                    tithes: tithesTotal,
                    formations: formationsThisYear.length,
                    photos: photosThisYear.length,
                    contributors: new Set(tithesThisYear.map(t => t.memberId)).size
                };
            }

            // Get growth data for charts
            getGrowthData() {
                const years = [2026, 2027, 2028, 2029, 2030, 2031];
                const data = {
                    members: [],
                    households: [],
                    tithes: [],
                    formations: [],
                    photos: []
                };
                
                years.forEach(year => {
                    const stats = this.getStats(year);
                    data.members.push(stats.members);
                    data.households.push(stats.households);
                    data.tithes.push(stats.tithes);
                    data.formations.push(stats.formations);
                    data.photos.push(stats.photos);
                });
                
                return data;
            }

            // Export all data
            exportData() {
                const data = {
                    members: this.members,
                    households: this.households,
                    tithes: this.tithes,
                    formations: this.formations,
                    photos: this.photos,
                    activities: this.activities,
                    exportedAt: new Date().toISOString(),
                    version: '1.0'
                };
                
                return JSON.stringify(data, null, 2);
            }

            // Import data
            importData(jsonData) {
                try {
                    const data = JSON.parse(jsonData);
                    
                    if (data.members) this.members = data.members;
                    if (data.households) this.households = data.households;
                    if (data.tithes) this.tithes = data.tithes;
                    if (data.formations) this.formations = data.formations;
                    if (data.photos) this.photos = data.photos;
                    if (data.activities) this.activities = data.activities;
                    
                    this.saveAllData();
                    return true;
                } catch (error) {
                    console.error('Error importing data:', error);
                    return false;
                }
            }

            // Clear all data
            clearData() {
                if (confirm('Are you sure you want to clear ALL data? This cannot be undone.')) {
                    this.members = [];
                    this.households = [];
                    this.tithes = [];
                    this.formations = [];
                    this.photos = [];
                    this.activities = [];
                    this.saveAllData();
                    return true;
                }
                return false;
            }

            // Generate test data
            generateTestData(count = 10) {
                const areas = Object.keys(LEYTE_AREAS);
                const firstNames = ['Juan', 'Maria', 'Pedro', 'Ana', 'Luis', 'Carmen', 'Jose', 'Teresa', 'Carlos', 'Elena'];
                const lastNames = ['Dela Cruz', 'Santos', 'Reyes', 'Garcia', 'Torres', 'Lim', 'Tan', 'Gomez', 'Ramos', 'Chua'];
                
                // Generate members
                for (let i = 0; i < count; i++) {
                    const area = areas[Math.floor(Math.random() * areas.length)];
                    const firstName = firstNames[Math.floor(Math.random() * firstNames.length)];
                    const lastName = lastNames[Math.floor(Math.random() * lastNames.length)];
                    
                    const member = {
                        name: `${firstName} ${lastName}`,
                        birthday: `19${Math.floor(Math.random() * 30) + 70}-${String(Math.floor(Math.random() * 12) + 1).padStart(2, '0')}-${String(Math.floor(Math.random() * 28) + 1).padStart(2, '0')}`,
                        contact: `09${Math.floor(Math.random() * 900000000) + 100000000}`,
                        email: `${firstName.toLowerCase()}.${lastName.toLowerCase().replace(' ', '')}@example.com`,
                        area: area,
                        household: null,
                        work: ['Teacher', 'Engineer', 'Nurse', 'Businessman', 'Farmer', 'Government Employee'][Math.floor(Math.random() * 6)],
                        functionality: ['member', 'hpm_leader', 'area_coordinator'][Math.floor(Math.random() * 3)],
                        memberSince: `2026-${String(Math.floor(Math.random() * 12) + 1).padStart(2, '0')}-${String(Math.floor(Math.random() * 28) + 1).padStart(2, '0')}`,
                        status: 'active',
                        address: `${Math.floor(Math.random() * 1000) + 1} ${area} City`,
                        notes: 'Test data generated',
                        createdAt: new Date().toISOString()
                    };
                    
                    this.addMember(member);
                }
                
                // Generate tithes for current year
                const currentYear = new Date().getFullYear();
                this.members.slice(0, Math.min(5, this.members.length)).forEach(member => {
                    for (let month = 1; month <= 12; month++) {
                        if (Math.random() > 0.5) { // 50% chance of tithe each month
                            const tithe = {
                                memberId: member.id,
                                memberName: member.name,
                                amount: Math.floor(Math.random() * 5000) + 500,
                                date: `${currentYear}-${String(month).padStart(2, '0')}-${String(Math.floor(Math.random() * 28) + 1).padStart(2, '0')}`,
                                type: ['regular', 'special', 'thanksgiving'][Math.floor(Math.random() * 3)],
                                method: ['cash', 'gcash', 'bank'][Math.floor(Math.random() * 3)],
                                reference: `T${Math.floor(Math.random() * 10000)}`,
                                area: member.area,
                                month: month,
                                year: currentYear,
                                notes: 'Test tithe',
                                createdAt: new Date().toISOString()
                            };
                            
                            this.addTithe(tithe);
                        }
                    }
                });
                
                this.showToast(`Generated ${count} test records`, 'success');
            }

            // Data integrity check
            checkDataIntegrity() {
                const issues = [];
                
                // Check for members without IDs
                this.members.forEach((member, index) => {
                    if (!member.id) issues.push(`Member at index ${index} has no ID`);
                    if (!member.name) issues.push(`Member ${member.id || index} has no name`);
                });
                
                // Check for duplicate IDs
                const memberIds = this.members.map(m => m.id);
                const duplicateMemberIds = memberIds.filter((id, index) => memberIds.indexOf(id) !== index);
                if (duplicateMemberIds.length > 0) {
                    issues.push(`Duplicate member IDs found: ${duplicateMemberIds.join(', ')}`);
                }
                
                // Check household references
                this.households.forEach(household => {
                    if (household.leaderId && !this.members.find(m => m.id === household.leaderId)) {
                        issues.push(`Household ${household.name} references non-existent leader ID ${household.leaderId}`);
                    }
                    
                    household.members.forEach(memberId => {
                        if (!this.members.find(m => m.id === memberId)) {
                            issues.push(`Household ${household.name} references non-existent member ID ${memberId}`);
                        }
                    });
                });
                
                // Check tithe references
                this.tithes.forEach(tithe => {
                    if (!this.members.find(m => m.id === tithe.memberId)) {
                        issues.push(`Tithe record ${tithe.reference} references non-existent member ID ${tithe.memberId}`);
                    }
                });
                
                // Check formation references
                this.formations.forEach(formation => {
                    formation.attendees.forEach(memberId => {
                        if (!this.members.find(m => m.id === memberId)) {
                            issues.push(`Formation ${formation.topic} references non-existent member ID ${memberId}`);
                        }
                    });
                });
                
                return issues;
            }

            // Fix data issues
            fixDataIssues() {
                const fixes = [];
                
                // Fix missing member IDs
                this.members.forEach((member, index) => {
                    if (!member.id) {
                        const newId = Math.max(0, ...this.members.map(m => m.id || 0)) + 1;
                        member.id = newId;
                        fixes.push(`Assigned ID ${newId} to member at index ${index}`);
                    }
                });
                
                // Fix duplicate IDs
                const usedIds = new Set();
                this.members.forEach(member => {
                    if (usedIds.has(member.id)) {
                        const newId = Math.max(0, ...this.members.map(m => m.id)) + 1;
                        member.id = newId;
                        fixes.push(`Changed duplicate ID to ${newId} for member ${member.name}`);
                    }
                    usedIds.add(member.id);
                });
                
                // Fix missing member names
                this.members.forEach(member => {
                    if (!member.name || member.name.trim() === '') {
                        member.name = `Unnamed Member ${member.id}`;
                        fixes.push(`Assigned name to member ID ${member.id}`);
                    }
                });
                
                // Fix household references
                this.households.forEach(household => {
                    if (household.leaderId && !this.members.find(m => m.id === household.leaderId)) {
                        // Find a valid member to assign as leader
                        const validMember = this.members.find(m => m.area === household.area);
                        if (validMember) {
                            household.leaderId = validMember.id;
                            household.leaderName = validMember.name;
                            fixes.push(`Fixed leader reference for household ${household.name}`);
                        }
                    }
                    
                    // Filter out invalid member references
                    const validMembers = household.members.filter(memberId => 
                        this.members.find(m => m.id === memberId)
                    );
                    if (validMembers.length !== household.members.length) {
                        const removed = household.members.length - validMembers.length;
                        household.members = validMembers;
                        fixes.push(`Removed ${removed} invalid member references from household ${household.name}`);
                    }
                });
                
                // Fix tithe references
                this.tithes = this.tithes.filter(tithe => {
                    const memberExists = this.members.find(m => m.id === tithe.memberId);
                    if (!memberExists) {
                        fixes.push(`Removed tithe record ${tithe.reference} referencing non-existent member`);
                        return false;
                    }
                    return true;
                });
                
                // Fix formation references
                this.formations.forEach(formation => {
                    const validAttendees = formation.attendees.filter(memberId => 
                        this.members.find(m => m.id === memberId)
                    );
                    if (validAttendees.length !== formation.attendees.length) {
                        const removed = formation.attendees.length - validAttendees.length;
                        formation.attendees = validAttendees;
                        formation.totalAttendees = validAttendees.length;
                        fixes.push(`Removed ${removed} invalid attendee references from formation ${formation.topic}`);
                    }
                });
                
                if (fixes.length > 0) {
                    this.saveAllData();
                }
                
                return fixes;
            }

            // Show toast notification
            showToast(message, type = 'success') {
                const toast = document.getElementById('toast');
                const toastMessage = document.getElementById('toastMessage');
                
                toastMessage.textContent = message;
                toast.className = `toast ${type}`;
                toast.classList.add('show');
                
                setTimeout(() => {
                    toast.classList.remove('show');
                }, 3000);
            }
        }

        // Initialize data manager
        const dataManager = new SOLDGrowthManager();
        let currentTithingYear = 2026;
        let currentGrowthYear = 'all';

        // Utility Functions
        function showToast(message, type = 'success') {
            dataManager.showToast(message, type);
        }

        function formatCurrency(amount) {
            return '₱' + amount.toLocaleString('en-PH', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            });
        }

        function formatDate(dateString) {
            if (!dateString) return '-';
            const date = new Date(dateString);
            return date.toLocaleDateString('en-PH', {
                year: 'numeric',
                month: 'short',
                day: 'numeric'
            });
        }

        // Tab switching
        function switchTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            
            document.getElementById(tabName).classList.add('active');
            document.querySelector(`.tab[data-tab="${tabName}"]`).classList.add('active');
            
            switch(tabName) {
                case 'dashboard':
                    loadDashboard();
                    break;
                case 'households':
                    loadHouseholds();
                    break;
                case 'members':
                    loadMembers();
                    break;
                case 'formations':
                    loadFormations();
                    break;
                case 'tithing':
                    loadTithing();
                    break;
                case 'growth':
                    loadGrowthAnalytics();
                    break;
                case 'reports':
                    loadReports();
                    break;
                case 'gallery':
                    loadPhotoGallery();
                    break;
                case 'data':
                    loadDataManagement();
                    break;
            }
        }

        // Modal Functions
        function openModal(modalId) {
            document.getElementById(modalId).style.display = 'flex';
            
            if (modalId === 'addHouseholdModal') {
                initHouseholdModal();
            } else if (modalId === 'addMemberModal') {
                initMemberModal();
            } else if (modalId === 'addFormationModal') {
                initFormationModal();
            } else if (modalId === 'recordTitheModal') {
                initTitheModal();
            } else if (modalId === 'addPhotoModal') {
                initPhotoModal();
            }
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        // Initialize Modals
        function initHouseholdModal() {
            const areaSelect = document.getElementById('householdArea');
            areaSelect.innerHTML = '<option value="">Select Area</option>';
            for (const [code, name] of Object.entries(LEYTE_AREAS)) {
                const option = document.createElement('option');
                option.value = code;
                option.textContent = name;
                areaSelect.appendChild(option);
            }
            
            const leaderSelect = document.getElementById('householdLeader');
            leaderSelect.innerHTML = '<option value="">Select Leader</option>';
            dataManager.members.forEach(member => {
                if (member.status === 'active') {
                    const option = document.createElement('option');
                    option.value = member.id;
                    option.textContent = `${member.name} (${LEYTE_AREAS[member.area]})`;
                    leaderSelect.appendChild(option);
                }
            });
            
            loadMemberGrid('householdMembersSelect');
        }

        function initMemberModal() {
            const areaSelect = document.getElementById('memberArea');
            areaSelect.innerHTML = '<option value="">Select Area</option>';
            for (const [code, name] of Object.entries(LEYTE_AREAS)) {
                const option = document.createElement('option');
                option.value = code;
                option.textContent = name;
                areaSelect.appendChild(option);
            }
            
            const householdSelect = document.getElementById('memberHousehold');
            householdSelect.innerHTML = '<option value="">Not Assigned</option>';
            dataManager.households.forEach(household => {
                const option = document.createElement('option');
                option.value = household.id;
                option.textContent = `${household.name} (${LEYTE_AREAS[household.area]})`;
                householdSelect.appendChild(option);
            });
            
            document.getElementById('memberSince').valueAsDate = new Date();
            document.getElementById('memberBirthday').valueAsDate = new Date(new Date().getFullYear() - 40, 0, 1);
        }

        function initFormationModal() {
            const areaSelect = document.getElementById('formationLocation');
            areaSelect.innerHTML = '<option value="">Select Area</option>';
            for (const [code, name] of Object.entries(LEYTE_AREAS)) {
                const option = document.createElement('option');
                option.value = code;
                option.textContent = name;
                areaSelect.appendChild(option);
            }
            
            document.getElementById('formationDate').valueAsDate = new Date();
            loadAreaMembers();
        }

        function loadAreaMembers() {
            const area = document.getElementById('formationLocation').value;
            const areaName = LEYTE_AREAS[area] || area;
            document.getElementById('selectedAreaName').textContent = areaName;
            
            const membersGrid = document.getElementById('formationAttendeesSelect');
            membersGrid.innerHTML = '';
            
            if (!area) return;
            
            const areaMembers = dataManager.members.filter(m => 
                m.area === area && m.status === 'active'
            );
            
            areaMembers.forEach(member => {
                const div = document.createElement('div');
                div.className = 'member-checkbox';
                div.onclick = function() {
                    const checkbox = this.querySelector('input[type="checkbox"]');
                    checkbox.checked = !checkbox.checked;
                    this.classList.toggle('selected', checkbox.checked);
                    updateSelectedCount();
                };
                
                div.innerHTML = `
                    <input type="checkbox" id="attendee_${member.id}" value="${member.id}">
                    <label for="attendee_${member.id}" style="margin: 0; flex: 1;">${member.name}</label>
                    <span class="pill pill-regular">${member.functionality}</span>
                `;
                membersGrid.appendChild(div);
            });
            
            updateSelectedCount();
        }

        function updateSelectedCount() {
            const selected = document.querySelectorAll('#formationAttendeesSelect input[type="checkbox"]:checked').length;
            document.getElementById('selectedCount').textContent = selected;
        }

        function selectAllMembers() {
            document.querySelectorAll('#formationAttendeesSelect input[type="checkbox"]').forEach(cb => {
                cb.checked = true;
                cb.parentElement.classList.add('selected');
            });
            updateSelectedCount();
        }

        function deselectAllMembers() {
            document.querySelectorAll('#formationAttendeesSelect input[type="checkbox"]').forEach(cb => {
                cb.checked = false;
                cb.parentElement.classList.remove('selected');
            });
            updateSelectedCount();
        }

        function initTitheModal() {
            const memberSelect = document.getElementById('titheMember');
            memberSelect.innerHTML = '<option value="">Select Member</option>';
            dataManager.members.forEach(member => {
                if (member.status === 'active') {
                    const option = document.createElement('option');
                    option.value = member.id;
                    option.textContent = `${member.name} (${LEYTE_AREAS[member.area]})`;
                    option.setAttribute('data-area', member.area);
                    memberSelect.appendChild(option);
                }
            });
            
            const today = new Date();
            document.getElementById('titheDate').valueAsDate = today;
            document.getElementById('titheMonth').value = today.getMonth() + 1;
            document.getElementById('titheYear').value = today.getFullYear();
        }

        function updateMemberArea() {
            const memberSelect = document.getElementById('titheMember');
            const selectedOption = memberSelect.options[memberSelect.selectedIndex];
            const area = selectedOption.getAttribute('data-area');
            document.getElementById('titheMemberArea').value = LEYTE_AREAS[area] || area;
        }

        function initPhotoModal() {
            const areaSelect = document.getElementById('photoArea');
            areaSelect.innerHTML = '<option value="">Select Area</option>';
            for (const [code, name] of Object.entries(LEYTE_AREAS)) {
                const option = document.createElement('option');
                option.value = code;
                option.textContent = name;
                areaSelect.appendChild(option);
            }
            
            document.getElementById('photoDate').valueAsDate = new Date();
            
            document.getElementById('photoFile').addEventListener('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const preview = document.getElementById('photoPreview');
                        preview.innerHTML = `<img src="${e.target.result}" style="width: 100%; height: 100%; object-fit: cover; border-radius: 4px;">`;
                    };
                    reader.readAsDataURL(file);
                }
            });
        }

        // Save Functions
        function saveHousehold() {
            const name = document.getElementById('householdName').value.trim();
            const area = document.getElementById('householdArea').value;
            const leaderId = document.getElementById('householdLeader').value;
            
            if (!name || !area || !leaderId) {
                showToast('Please fill in all required fields', 'error');
                return;
            }
            
            const selectedMembers = [];
            document.querySelectorAll('#householdMembersSelect input[type="checkbox"]:checked').forEach(cb => {
                selectedMembers.push(parseInt(cb.value));
            });
            
            const household = {
                name: name,
                area: area,
                leaderId: parseInt(leaderId),
                leaderName: document.getElementById('householdLeader').options[document.getElementById('householdLeader').selectedIndex].text.split(' (')[0],
                meetingDay: document.getElementById('meetingDay').value,
                meetingTime: document.getElementById('meetingTime').value,
                residence: document.getElementById('residenceAddress').value.trim(),
                members: selectedMembers,
                notes: document.getElementById('householdNotes').value.trim(),
                status: 'active'
            };
            
            dataManager.addHousehold(household);
            closeModal('addHouseholdModal');
            loadHouseholds();
            showToast('Household added successfully!');
        }

        function saveMember() {
            const name = document.getElementById('memberName').value.trim();
            const birthday = document.getElementById('memberBirthday').value;
            const area = document.getElementById('memberArea').value;
            const memberSince = document.getElementById('memberSince').value;
            
            if (!name || !birthday || !area || !memberSince) {
                showToast('Please fill in all required fields', 'error');
                return;
            }
            
            const member = {
                name: name,
                birthday: birthday,
                contact: document.getElementById('memberContact').value.trim(),
                email: document.getElementById('memberEmail').value.trim(),
                area: area,
                household: document.getElementById('memberHousehold').value || null,
                work: document.getElementById('memberWork').value.trim(),
                functionality: document.getElementById('memberFunctionality').value,
                memberSince: memberSince,
                status: document.getElementById('memberStatus').value,
                address: document.getElementById('memberAddress').value.trim(),
                notes: document.getElementById('memberNotes').value.trim()
            };
            
            dataManager.addMember(member);
            closeModal('addMemberModal');
            loadMembers();
            showToast('Member added successfully!');
        }

        function saveFormation() {
            const topic = document.getElementById('formationTopic').value.trim();
            const speaker = document.getElementById('formationSpeaker').value.trim();
            const date = document.getElementById('formationDate').value;
            const location = document.getElementById('formationLocation').value;
            const venue = document.getElementById('formationVenue').value.trim();
            const time = document.getElementById('formationTime').value;
            
            if (!topic || !speaker || !date || !location || !venue || !time) {
                showToast('Please fill in all required fields', 'error');
                return;
            }
            
            const selectedAttendees = [];
            document.querySelectorAll('#formationAttendeesSelect input[type="checkbox"]:checked').forEach(cb => {
                selectedAttendees.push(parseInt(cb.value));
            });
            
            const formation = {
                topic: topic,
                speaker: speaker,
                date: date,
                time: time,
                location: location,
                venue: venue,
                duration: document.getElementById('formationDuration').value || 2,
                yearProgram: document.getElementById('formationYearProgram').value,
                description: document.getElementById('formationDescription').value.trim(),
                attendees: selectedAttendees,
                status: new Date(date) >= new Date() ? 'upcoming' : 'completed'
            };
            
            dataManager.addFormation(formation);
            closeModal('addFormationModal');
            loadFormations();
            showToast('Formation talk scheduled successfully!');
        }

        function saveTithe() {
            const memberId = document.getElementById('titheMember').value;
            const amount = parseFloat(document.getElementById('titheAmount').value);
            const date = document.getElementById('titheDate').value;
            
            if (!memberId || !amount || !date) {
                showToast('Please fill in all required fields', 'error');
                return;
            }
            
            const member = dataManager.getMember(parseInt(memberId));
            if (!member) {
                showToast('Selected member not found', 'error');
                return;
            }
            
            const tithe = {
                memberId: parseInt(memberId),
                memberName: member.name,
                amount: amount,
                date: date,
                type: document.getElementById('titheType').value,
                method: document.getElementById('titheMethod').value,
                reference: document.getElementById('titheReference').value.trim(),
                area: member.area,
                month: parseInt(document.getElementById('titheMonth').value),
                year: parseInt(document.getElementById('titheYear').value),
                notes: document.getElementById('titheNotes').value.trim()
            };
            
            dataManager.addTithe(tithe);
            closeModal('recordTitheModal');
            loadTithing();
            showToast('Tithe recorded successfully!');
        }

        function savePhoto() {
            const activity = document.getElementById('photoActivity').value.trim();
            const date = document.getElementById('photoDate').value;
            const area = document.getElementById('photoArea').value;
            const venue = document.getElementById('photoVenue').value.trim();
            
            if (!activity || !date || !area || !venue) {
                showToast('Please fill in all required fields', 'error');
                return;
            }
            
            const photoFile = document.getElementById('photoFile').files[0];
            let photoData = '';
            
            if (photoFile) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const photo = {
                        activity: activity,
                        activityType: document.getElementById('photoActivityType').value,
                        date: date,
                        area: area,
                        venue: venue,
                        attendees: parseInt(document.getElementById('photoAttendees').value) || 0,
                        description: document.getElementById('photoDescription').value.trim(),
                        photoData: e.target.result,
                        year: new Date(date).getFullYear()
                    };
                    
                    dataManager.addPhoto(photo);
                    closeModal('addPhotoModal');
                    loadPhotoGallery();
                    showToast('Photo added successfully!');
                };
                reader.readAsDataURL(photoFile);
            } else {
                // Use a placeholder if no photo is uploaded
                const photo = {
                    activity: activity,
                    activityType: document.getElementById('photoActivityType').value,
                    date: date,
                    area: area,
                    venue: venue,
                    attendees: parseInt(document.getElementById('photoAttendees').value) || 0,
                    description: document.getElementById('photoDescription').value.trim(),
                    photoData: 'data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMjAwIiBoZWlnaHQ9IjIwMCIgdmlld0JveD0iMCAwIDIwMCAyMDAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHJlY3Qgd2lkdGg9IjIwMCIgaGVpZ2h0PSIyMDAiIGZpbGw9IiMxYTIzN2UiLz48dGV4dCB4PSI1MCUiIHk9IjUwJSIgZG9taW5hbnQtYmFzZWxpbmU9Im1pZGRsZSIgdGV4dC1hbmNob3I9Im1pZGRsZSIgZmlsbD0iI0ZGRkZGRiIgZm9udC1zaXplPSIyNCI+U09MRCA8L3RleHQ+PHRleHQgeD0iNTAlIiB5PSI3MCUiIGRvbWluYW50LWJhc2VsaW5lPSJtaWRkbGUiIHRleHQtYW5jaG9yPSJtaWRkbGUiIGZpbGw9IiNGRkZGRkYiIGZvbnQtc2l6ZT0iMTIiPkFjdGl2aXR5IFBob3RvPC90ZXh0Pjwvc3ZnPg==',
                    year: new Date(date).getFullYear()
                };
                
                dataManager.addPhoto(photo);
                closeModal('addPhotoModal');
                loadPhotoGallery();
                showToast('Photo added successfully!');
            }
        }

        // Edit Functions
        function editHousehold(id) {
            const household = dataManager.getHousehold(id);
            if (!household) return;
            
            document.getElementById('editHouseholdId').value = household.id;
            document.getElementById('editHouseholdName').value = household.name;
            document.getElementById('editHouseholdArea').value = household.area;
            document.getElementById('editHouseholdLeader').value = household.leaderId;
            document.getElementById('editMeetingDay').value = household.meetingDay;
            document.getElementById('editMeetingTime').value = household.meetingTime;
            document.getElementById('editResidenceAddress').value = household.residence;
            document.getElementById('editHouseholdNotes').value = household.notes || '';
            document.getElementById('editHouseholdStatus').value = household.status;
            
            // Load areas
            const areaSelect = document.getElementById('editHouseholdArea');
            areaSelect.innerHTML = '<option value="">Select Area</option>';
            for (const [code, name] of Object.entries(LEYTE_AREAS)) {
                const option = document.createElement('option');
                option.value = code;
                option.textContent = name;
                option.selected = code === household.area;
                areaSelect.appendChild(option);
            }
            
            // Load leaders
            const leaderSelect = document.getElementById('editHouseholdLeader');
            leaderSelect.innerHTML = '<option value="">Select Leader</option>';
            dataManager.members.forEach(member => {
                if (member.status === 'active') {
                    const option = document.createElement('option');
                    option.value = member.id;
                    option.textContent = `${member.name} (${LEYTE_AREAS[member.area]})`;
                    option.selected = member.id === household.leaderId;
                    leaderSelect.appendChild(option);
                }
            });
            
            // Load members
            loadEditMemberGrid(household.members);
            
            openModal('editHouseholdModal');
        }

        function updateHousehold() {
            const id = parseInt(document.getElementById('editHouseholdId').value);
            const name = document.getElementById('editHouseholdName').value.trim();
            const area = document.getElementById('editHouseholdArea').value;
            const leaderId = document.getElementById('editHouseholdLeader').value;
            
            if (!name || !area || !leaderId) {
                showToast('Please fill in all required fields', 'error');
                return;
            }
            
            const selectedMembers = [];
            document.querySelectorAll('#editHouseholdMembersSelect input[type="checkbox"]:checked').forEach(cb => {
                selectedMembers.push(parseInt(cb.value));
            });
            
            const updates = {
                name: name,
                area: area,
                leaderId: parseInt(leaderId),
                leaderName: document.getElementById('editHouseholdLeader').options[document.getElementById('editHouseholdLeader').selectedIndex].text.split(' (')[0],
                meetingDay: document.getElementById('editMeetingDay').value,
                meetingTime: document.getElementById('editMeetingTime').value,
                residence: document.getElementById('editResidenceAddress').value.trim(),
                members: selectedMembers,
                notes: document.getElementById('editHouseholdNotes').value.trim(),
                status: document.getElementById('editHouseholdStatus').value
            };
            
            if (dataManager.updateHousehold(id, updates)) {
                closeModal('editHouseholdModal');
                loadHouseholds();
                showToast('Household updated successfully!');
            } else {
                showToast('Error updating household', 'error');
            }
        }

        function deleteHousehold() {
            const id = parseInt(document.getElementById('editHouseholdId').value);
            
            if (confirm('Are you sure you want to delete this household?')) {
                if (dataManager.deleteHousehold(id)) {
                    closeModal('editHouseholdModal');
                    loadHouseholds();
                    showToast('Household deleted successfully!');
                } else {
                    showToast('Error deleting household', 'error');
                }
            }
        }

        function editMember(id) {
            const member = dataManager.getMember(id);
            if (!member) return;
            
            document.getElementById('editMemberId').value = member.id;
            document.getElementById('editMemberName').value = member.name;
            document.getElementById('editMemberBirthday').value = member.birthday;
            document.getElementById('editMemberContact').value = member.contact || '';
            document.getElementById('editMemberEmail').value = member.email || '';
            document.getElementById('editMemberArea').value = member.area;
            document.getElementById('editMemberHousehold').value = member.household || '';
            document.getElementById('editMemberWork').value = member.work || '';
            document.getElementById('editMemberFunctionality').value = member.functionality;
            document.getElementById('editMemberSince').value = member.memberSince;
            document.getElementById('editMemberStatus').value = member.status;
            document.getElementById('editMemberAddress').value = member.address || '';
            document.getElementById('editMemberNotes').value = member.notes || '';
            
            // Load areas
            const areaSelect = document.getElementById('editMemberArea');
            areaSelect.innerHTML = '<option value="">Select Area</option>';
            for (const [code, name] of Object.entries(LEYTE_AREAS)) {
                const option = document.createElement('option');
                option.value = code;
                option.textContent = name;
                option.selected = code === member.area;
                areaSelect.appendChild(option);
            }
            
            // Load households
            const householdSelect = document.getElementById('editMemberHousehold');
            householdSelect.innerHTML = '<option value="">Not Assigned</option>';
            dataManager.households.forEach(household => {
                const option = document.createElement('option');
                option.value = household.id;
                option.textContent = `${household.name} (${LEYTE_AREAS[household.area]})`;
                option.selected = household.id === member.household;
                householdSelect.appendChild(option);
            });
            
            openModal('editMemberModal');
        }

        function updateMember() {
            const id = parseInt(document.getElementById('editMemberId').value);
            const name = document.getElementById('editMemberName').value.trim();
            const birthday = document.getElementById('editMemberBirthday').value;
            const area = document.getElementById('editMemberArea').value;
            const memberSince = document.getElementById('editMemberSince').value;
            
            if (!name || !birthday || !area || !memberSince) {
                showToast('Please fill in all required fields', 'error');
                return;
            }
            
            const updates = {
                name: name,
                birthday: birthday,
                contact: document.getElementById('editMemberContact').value.trim(),
                email: document.getElementById('editMemberEmail').value.trim(),
                area: area,
                household: document.getElementById('editMemberHousehold').value || null,
                work: document.getElementById('editMemberWork').value.trim(),
                functionality: document.getElementById('editMemberFunctionality').value,
                memberSince: memberSince,
                status: document.getElementById('editMemberStatus').value,
                address: document.getElementById('editMemberAddress').value.trim(),
                notes: document.getElementById('editMemberNotes').value.trim()
            };
            
            if (dataManager.updateMember(id, updates)) {
                closeModal('editMemberModal');
                loadMembers();
                showToast('Member updated successfully!');
            } else {
                showToast('Error updating member', 'error');
            }
        }

        function deleteMember() {
            const id = parseInt(document.getElementById('editMemberId').value);
            
            if (confirm('Are you sure you want to delete this member?')) {
                if (dataManager.deleteMember(id)) {
                    closeModal('editMemberModal');
                    loadMembers();
                    showToast('Member deleted successfully!');
                } else {
                    showToast('Error deleting member', 'error');
                }
            }
        }

        // Load Functions
        function loadDashboard() {
            const stats = dataManager.getStats(2026);
            
            document.getElementById('totalHouseholds').textContent = stats.households;
            document.getElementById('totalMembers').textContent = stats.members;
            document.getElementById('yearlyTithes').textContent = formatCurrency(stats.tithes);
            document.getElementById('formationsCompleted').textContent = stats.formations;
            
            // Load recent photos
            loadRecentPhotos();
            
            // Load recent activities
            loadRecentActivities();
            
            // Initialize charts
            initializeDashboardCharts();
        }

        function loadRecentPhotos() {
            const recentPhotos = [...dataManager.photos]
                .sort((a, b) => new Date(b.date) - new Date(a.date))
                .slice(0, 6);
            
            const container = document.getElementById('recentPhotos');
            container.innerHTML = '';
            
            recentPhotos.forEach(photo => {
                const photoCard = document.createElement('div');
                photoCard.className = 'photo-card';
                photoCard.innerHTML = `
                    <div class="photo-img">
                        <img src="${photo.photoData}" style="width: 100%; height: 100%; object-fit: cover;">
                    </div>
                    <div class="photo-details">
                        <div class="photo-title">${photo.activity}</div>
                        <div class="photo-meta">
                            <div><i class="fas fa-calendar"></i> ${formatDate(photo.date)}</div>
                            <div><i class="fas fa-map-marker-alt"></i> ${LEYTE_AREAS[photo.area] || photo.area}</div>
                            ${photo.attendees ? `<div><i class="fas fa-users"></i> ${photo.attendees} attendees</div>` : ''}
                        </div>
                    </div>
                `;
                container.appendChild(photoCard);
            });
        }

        function loadRecentActivities() {
            const recentActivities = [...dataManager.activities]
                .sort((a, b) => new Date(b.date) - new Date(a.date))
                .slice(0, 10);
            
            const container = document.getElementById('recentActivities');
            container.innerHTML = '';
            
            recentActivities.forEach(activity => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${formatDate(activity.date)}</td>
                    <td>${activity.description}</td>
                    <td>${LEYTE_AREAS[activity.area] || activity.area}</td>
                    <td>${activity.attendees || '-'}</td>
                    <td><span class="pill ${activity.status === 'completed' ? 'pill-attended' : 'pill-pending'}">${activity.status}</span></td>
                `;
                container.appendChild(row);
            });
        }

        function initializeDashboardCharts() {
            // Growth Chart
            const growthCtx = document.getElementById('growthChart').getContext('2d');
            const growthData = dataManager.getGrowthData();
            
            new Chart(growthCtx, {
                type: 'line',
                data: {
                    labels: ['2026', '2027', '2028', '2029', '2030', '2031'],
                    datasets: [{
                        label: 'Members Growth',
                        data: growthData.members,
                        borderColor: '#1a237e',
                        backgroundColor: 'rgba(26, 35, 126, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                callback: function(value) {
                                    return value.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });
            
            // Area Distribution Chart
            const areaCtx = document.getElementById('areaChart').getContext('2d');
            const areaData = {};
            
            dataManager.members.forEach(member => {
                if (member.status === 'active') {
                    areaData[member.area] = (areaData[member.area] || 0) + 1;
                }
            });
            
            // Get top 10 areas
            const topAreas = Object.entries(areaData)
                .sort((a, b) => b[1] - a[1])
                .slice(0, 10);
            
            new Chart(areaCtx, {
                type: 'bar',
                data: {
                    labels: topAreas.map(([area]) => LEYTE_AREAS[area] || area),
                    datasets: [{
                        label: 'Active Members',
                        data: topAreas.map(([, count]) => count),
                        backgroundColor: '#283593',
                        borderColor: '#1a237e',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            }
                        }
                    }
                }
            });
        }

        function loadHouseholds() {
            const container = document.getElementById('householdList');
            const tableBody = document.getElementById('householdsData');
            
            container.innerHTML = '';
            tableBody.innerHTML = '';
            
            // Load area filter
            const areaFilter = document.getElementById('householdAreaFilter');
            areaFilter.innerHTML = '<option value="">All Areas</option>';
            for (const [code, name] of Object.entries(LEYTE_AREAS)) {
                const option = document.createElement('option');
                option.value = code;
                option.textContent = name;
                areaFilter.appendChild(option);
            }
            
            dataManager.households.forEach(household => {
                // Card view
                const card = document.createElement('div');
                card.className = 'household-card';
                card.innerHTML = `
                    <div class="household-header">
                        <div class="household-name">${household.name}</div>
                        <span class="pill ${household.status === 'active' ? 'pill-active' : 'pill-inactive'}">${household.status}</span>
                    </div>
                    <div style="margin-bottom: 0.5rem;">
                        <i class="fas fa-map-marker-alt"></i> ${LEYTE_AREAS[household.area] || household.area}
                    </div>
                    <div style="margin-bottom: 0.5rem;">
                        <i class="fas fa-user"></i> ${household.leaderName}
                    </div>
                    <div style="margin-bottom: 0.5rem;">
                        <i class="fas fa-users"></i> ${household.members.length} members
                    </div>
                    <div style="margin-bottom: 0.5rem;">
                        <i class="fas fa-calendar"></i> Every ${household.meetingDay} at ${household.meetingTime}
                    </div>
                    <div style="display: flex; gap: 0.5rem; margin-top: 1rem;">
                        <button class="btn btn-small" onclick="editHousehold(${household.id})">
                            <i class="fas fa-edit"></i> Edit
                        </button>
                        <button class="btn btn-small btn-success" onclick="viewHousehold(${household.id})">
                            <i class="fas fa-eye"></i> View
                        </button>
                    </div>
                `;
                container.appendChild(card);
                
                // Table view
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${household.name}</td>
                    <td>${LEYTE_AREAS[household.area] || household.area}</td>
                    <td>${household.leaderName}</td>
                    <td>${household.members.length}</td>
                    <td>${household.residence}</td>
                    <td>${household.meetingDay}</td>
                    <td><span class="pill ${household.status === 'active' ? 'pill-active' : 'pill-inactive'}">${household.status}</span></td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-small" onclick="editHousehold(${household.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-small btn-success" onclick="viewHousehold(${household.id})">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        function loadMembers() {
            const tableBody = document.getElementById('membersList');
            tableBody.innerHTML = '';
            
            // Load area filter
            const areaFilter = document.getElementById('memberAreaFilter');
            areaFilter.innerHTML = '<option value="">All Areas</option>';
            for (const [code, name] of Object.entries(LEYTE_AREAS)) {
                const option = document.createElement('option');
                option.value = code;
                option.textContent = name;
                areaFilter.appendChild(option);
            }
            
            // Load household filter
            const householdFilter = document.getElementById('memberHouseholdFilter');
            householdFilter.innerHTML = '<option value="">All Households</option>';
            dataManager.households.forEach(household => {
                const option = document.createElement('option');
                option.value = household.id;
                option.textContent = household.name;
                householdFilter.appendChild(option);
            });
            
            dataManager.members.forEach(member => {
                const household = member.household ? dataManager.getHousehold(member.household) : null;
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${member.name}</td>
                    <td>${formatDate(member.birthday)}</td>
                    <td>${LEYTE_AREAS[member.area] || member.area}</td>
                    <td>${household ? household.name : 'Not Assigned'}</td>
                    <td><span class="pill ${member.functionality === 'member' ? 'pill-regular' : 'pill-leader'}">${member.functionality.replace('_', ' ')}</span></td>
                    <td>${formatDate(member.memberSince)}</td>
                    <td><span class="pill ${member.status === 'active' ? 'pill-active' : 'pill-inactive'}">${member.status}</span></td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-small" onclick="editMember(${member.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-small btn-success" onclick="viewMember(${member.id})">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        function loadFormations() {
            const tableBody = document.getElementById('formationsList');
            tableBody.innerHTML = '';
            
            // Load area filter
            const areaFilter = document.getElementById('formationAreaFilter');
            areaFilter.innerHTML = '<option value="">All Areas</option>';
            for (const [code, name] of Object.entries(LEYTE_AREAS)) {
                const option = document.createElement('option');
                option.value = code;
                option.textContent = name;
                areaFilter.appendChild(option);
            }
            
            // Load upcoming talks
            const upcomingContainer = document.getElementById('upcomingTalks');
            const upcomingTalks = dataManager.formations
                .filter(f => f.status === 'upcoming')
                .slice(0, 5);
            
            upcomingContainer.innerHTML = '';
            upcomingTalks.forEach(talk => {
                const div = document.createElement('div');
                div.style.cssText = 'margin-bottom: 1rem; padding: 0.8rem; background: #f8f9fa; border-radius: 6px;';
                div.innerHTML = `
                    <div style="font-weight: 600; color: #1a237e;">${talk.topic}</div>
                    <div style="font-size: 0.8rem; color: #666;">
                        <i class="fas fa-calendar"></i> ${formatDate(talk.date)}<br>
                        <i class="fas fa-map-marker-alt"></i> ${LEYTE_AREAS[talk.location] || talk.location}
                    </div>
                `;
                upcomingContainer.appendChild(div);
            });
            
            // Load all formations
            dataManager.formations.sort((a, b) => new Date(b.date) - new Date(a.date)).forEach(formation => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${formatDate(formation.date)}</td>
                    <td>${formation.topic}</td>
                    <td>${LEYTE_AREAS[formation.location] || formation.location}</td>
                    <td>${formation.venue}</td>
                    <td>${formation.speaker}</td>
                    <td>${formation.totalAttendees || 0}</td>
                    <td><span class="pill ${formation.status === 'completed' ? 'pill-attended' : 'pill-pending'}">${formation.status}</span></td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-small" onclick="editFormation(${formation.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                            <button class="btn btn-small btn-success" onclick="viewFormation(${formation.id})">
                                <i class="fas fa-eye"></i>
                            </button>
                        </div>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        function loadTithing() {
            const tableBody = document.getElementById('tithingList');
            const monthlyContainer = document.getElementById('monthlyTithing');
            
            tableBody.innerHTML = '';
            monthlyContainer.innerHTML = '';
            
            // Load area filter
            const areaFilter = document.getElementById('titheAreaFilter');
            areaFilter.innerHTML = '<option value="">All Areas</option>';
            for (const [code, name] of Object.entries(LEYTE_AREAS)) {
                const option = document.createElement('option');
                option.value = code;
                option.textContent = name;
                areaFilter.appendChild(option);
            }
            
            // Calculate statistics
            const tithesThisYear = dataManager.tithes.filter(t => t.year === currentTithingYear);
            const ytdTotal = tithesThisYear.reduce((sum, t) => sum + t.amount, 0);
            const monthlyAverage = ytdTotal / 12;
            const uniqueContributors = new Set(tithesThisYear.map(t => t.memberId)).size;
            
            // Find highest contributor
            let highestContributor = { amount: 0, name: '-' };
            const contributorTotals = {};
            tithesThisYear.forEach(tithe => {
                if (!contributorTotals[tithe.memberId]) {
                    contributorTotals[tithe.memberId] = {
                        name: tithe.memberName,
                        total: 0
                    };
                }
                contributorTotals[tithe.memberId].total += tithe.amount;
                
                if (contributorTotals[tithe.memberId].total > highestContributor.amount) {
                    highestContributor = {
                        amount: contributorTotals[tithe.memberId].total,
                        name: tithe.memberName
                    };
                }
            });
            
            // Update statistics
            document.getElementById('ytdTotal').textContent = formatCurrency(ytdTotal);
            document.getElementById('ytdYear').textContent = currentTithingYear;
            document.getElementById('monthlyAverage').textContent = formatCurrency(monthlyAverage);
            document.getElementById('totalContributors').textContent = uniqueContributors;
            document.getElementById('highestContributor').textContent = formatCurrency(highestContributor.amount);
            document.getElementById('contributorName').textContent = highestContributor.name;
            document.getElementById('selectedYear').textContent = currentTithingYear;
            
            // Load monthly breakdown
            const months = ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun', 'Jul', 'Aug', 'Sep', 'Oct', 'Nov', 'Dec'];
            for (let month = 1; month <= 12; month++) {
                const monthTotal = tithesThisYear
                    .filter(t => t.month === month)
                    .reduce((sum, t) => sum + t.amount, 0);
                
                const monthCard = document.createElement('div');
                monthCard.className = 'month-card';
                monthCard.innerHTML = `
                    <div style="font-weight: 600; margin-bottom: 0.3rem;">${months[month-1]}</div>
                    <div style="color: #2E7D32; font-weight: bold;">₱${monthTotal.toLocaleString()}</div>
                    <div style="font-size: 0.8rem; color: #666;">${((monthTotal/ytdTotal)*100).toFixed(1)}%</div>
                `;
                monthlyContainer.appendChild(monthCard);
            }
            
            // Load all tithes
            tithesThisYear.sort((a, b) => new Date(b.date) - new Date(a.date)).forEach(tithe => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${formatDate(tithe.date)}</td>
                    <td>${tithe.memberName}</td>
                    <td style="font-weight: bold; color: #2E7D32;">${formatCurrency(tithe.amount)}</td>
                    <td>${tithe.type}</td>
                    <td>${LEYTE_AREAS[tithe.area] || tithe.area}</td>
                    <td>${new Date(2000, tithe.month-1).toLocaleString('default', { month: 'long' })} ${tithe.year}</td>
                    <td>${tithe.reference || '-'}</td>
                    <td>
                        <div class="action-buttons">
                            <button class="btn btn-small" onclick="editTithe(${tithe.id})">
                                <i class="fas fa-edit"></i>
                            </button>
                        </div>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        function loadGrowthAnalytics() {
            const growthData = dataManager.getGrowthData();
            
            // Initialize charts
            initializeGrowthCharts(growthData);
            
            // Load growth comparison table
            loadGrowthComparisonTable(growthData);
            
            // Load area performance table
            loadAreaPerformanceTable();
        }

        function initializeGrowthCharts(growthData) {
            const years = ['2026', '2027', '2028', '2029', '2030', '2031'];
            
            // Membership Growth Chart
            const memberCtx = document.getElementById('membershipGrowthChart').getContext('2d');
            new Chart(memberCtx, {
                type: 'line',
                data: {
                    labels: years,
                    datasets: [{
                        label: 'Members',
                        data: growthData.members,
                        borderColor: '#1a237e',
                        backgroundColor: 'rgba(26, 35, 126, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Membership Growth 2026-2031'
                        }
                    }
                }
            });
            
            // Household Growth Chart
            const householdCtx = document.getElementById('householdGrowthChart').getContext('2d');
            new Chart(householdCtx, {
                type: 'bar',
                data: {
                    labels: years,
                    datasets: [{
                        label: 'Households',
                        data: growthData.households,
                        backgroundColor: '#283593',
                        borderColor: '#1a237e',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Household Growth 2026-2031'
                        }
                    }
                }
            });
            
            // Tithing Growth Chart
            const tithingCtx = document.getElementById('tithingGrowthChart').getContext('2d');
            new Chart(tithingCtx, {
                type: 'line',
                data: {
                    labels: years,
                    datasets: [{
                        label: 'Tithing (₱)',
                        data: growthData.tithes,
                        borderColor: '#2E7D32',
                        backgroundColor: 'rgba(46, 125, 50, 0.1)',
                        tension: 0.4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Tithing Growth 2026-2031'
                        }
                    },
                    scales: {
                        y: {
                            ticks: {
                                callback: function(value) {
                                    return '₱' + value.toLocaleString();
                                }
                            }
                        }
                    }
                }
            });
            
            // Formation Growth Chart
            const formationCtx = document.getElementById('formationGrowthChart').getContext('2d');
            new Chart(formationCtx, {
                type: 'bar',
                data: {
                    labels: years,
                    datasets: [{
                        label: 'Formations',
                        data: growthData.formations,
                        backgroundColor: '#EF6C00',
                        borderColor: '#D84315',
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        title: {
                            display: true,
                            text: 'Formation Activities 2026-2031'
                        }
                    }
                }
            });
        }

        function loadGrowthComparisonTable(growthData) {
            const tableBody = document.getElementById('growthComparison');
            tableBody.innerHTML = '';
            
            const metrics = [
                {
                    name: 'Members',
                    data: growthData.members,
                    format: (value) => value.toLocaleString()
                },
                {
                    name: 'Households',
                    data: growthData.households,
                    format: (value) => value.toLocaleString()
                },
                {
                    name: 'Tithes (₱)',
                    data: growthData.tithes,
                    format: (value) => formatCurrency(value)
                },
                {
                    name: 'Formations',
                    data: growthData.formations,
                    format: (value) => value.toLocaleString()
                },
                {
                    name: 'Photos',
                    data: growthData.photos,
                    format: (value) => value.toLocaleString()
                }
            ];
            
            metrics.forEach(metric => {
                const totalGrowth = metric.data[5] - metric.data[0];
                const growthPercent = metric.data[0] > 0 ? ((totalGrowth / metric.data[0]) * 100).toFixed(1) : '∞';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td style="font-weight: 600;">${metric.name}</td>
                    <td>${metric.format(metric.data[0])}</td>
                    <td>${metric.format(metric.data[1])}</td>
                    <td>${metric.format(metric.data[2])}</td>
                    <td>${metric.format(metric.data[3])}</td>
                    <td>${metric.format(metric.data[4])}</td>
                    <td>${metric.format(metric.data[5])}</td>
                    <td style="font-weight: bold; color: ${totalGrowth >= 0 ? '#2E7D32' : '#C62828'}">
                        ${totalGrowth >= 0 ? '+' : ''}${metric.format(totalGrowth)} (${growthPercent}%)
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        function loadAreaPerformanceTable() {
            const tableBody = document.getElementById('areaPerformance');
            tableBody.innerHTML = '';
            
            const areaStats = {};
            
            // Calculate area statistics
            dataManager.households.forEach(household => {
                if (!areaStats[household.area]) {
                    areaStats[household.area] = {
                        households: 0,
                        members: new Set(),
                        tithes2026: 0,
                        tithes2027: 0,
                        formations: 0
                    };
                }
                areaStats[household.area].households++;
                household.members.forEach(memberId => areaStats[household.area].members.add(memberId));
            });
            
            // Add tithes
            dataManager.tithes.forEach(tithe => {
                if (areaStats[tithe.area]) {
                    if (tithe.year === 2026) {
                        areaStats[tithe.area].tithes2026 += tithe.amount;
                    } else if (tithe.year === 2027) {
                        areaStats[tithe.area].tithes2027 += tithe.amount;
                    }
                }
            });
            
            // Add formations
            dataManager.formations.forEach(formation => {
                if (areaStats[formation.location]) {
                    areaStats[formation.location].formations++;
                }
            });
            
            // Create table rows
            for (const [area, stats] of Object.entries(areaStats)) {
                const growthPercent = stats.tithes2026 > 0 ? 
                    ((stats.tithes2027 - stats.tithes2026) / stats.tithes2026 * 100).toFixed(1) : 
                    stats.tithes2027 > 0 ? '∞' : '0.0';
                
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${LEYTE_AREAS[area] || area}</td>
                    <td>${stats.households}</td>
                    <td>${stats.members.size}</td>
                    <td>${formatCurrency(stats.tithes2026)}</td>
                    <td>${formatCurrency(stats.tithes2027)}</td>
                    <td style="color: ${stats.tithes2027 >= stats.tithes2026 ? '#2E7D32' : '#C62828'}">
                        ${growthPercent}%
                    </td>
                    <td>${stats.formations}</td>
                `;
                tableBody.appendChild(row);
            }
        }

        function loadPhotoGallery() {
            const container = document.getElementById('photoGallery');
            container.innerHTML = '';
            
            // Load filters
            const areaFilter = document.getElementById('galleryAreaFilter');
            areaFilter.innerHTML = '<option value="">All Areas</option>';
            for (const [code, name] of Object.entries(LEYTE_AREAS)) {
                const option = document.createElement('option');
                option.value = code;
                option.textContent = name;
                areaFilter.appendChild(option);
            }
            
            // Load statistics
            const totalPhotos = dataManager.photos.length;
            const totalActivities = new Set(dataManager.photos.map(p => p.activity)).size;
            const photos2026 = dataManager.photos.filter(p => p.year === 2026).length;
            const latestPhoto = dataManager.photos.length > 0 ? 
                [...dataManager.photos].sort((a, b) => new Date(b.date) - new Date(a.date))[0] : 
                null;
            
            document.getElementById('totalPhotos').textContent = totalPhotos;
            document.getElementById('totalActivities').textContent = totalActivities;
            document.getElementById('photos2026').textContent = photos2026;
            document.getElementById('latestPhotoDate').textContent = latestPhoto ? formatDate(latestPhoto.date) : '-';
            document.getElementById('latestActivity').textContent = latestPhoto ? latestPhoto.activity : '-';
            
            // Load photos
            dataManager.photos.sort((a, b) => new Date(b.date) - new Date(a.date)).forEach(photo => {
                const photoCard = document.createElement('div');
                photoCard.className = 'photo-card';
                photoCard.innerHTML = `
                    <div class="photo-img">
                        <img src="${photo.photoData}" style="width: 100%; height: 100%; object-fit: cover;">
                    </div>
                    <div class="photo-details">
                        <div class="photo-title">${photo.activity}</div>
                        <div class="photo-meta">
                            <div><i class="fas fa-calendar"></i> ${formatDate(photo.date)}</div>
                            <div><i class="fas fa-map-marker-alt"></i> ${LEYTE_AREAS[photo.area] || photo.area}</div>
                            <div><i class="fas fa-tag"></i> ${photo.activityType}</div>
                            ${photo.attendees ? `<div><i class="fas fa-users"></i> ${photo.attendees} attendees</div>` : ''}
                        </div>
                        <div style="margin-top: 0.5rem; font-size: 0.9rem; color: #333;">
                            ${photo.description || ''}
                        </div>
                    </div>
                `;
                container.appendChild(photoCard);
            });
        }

        function loadDataManagement() {
            // Load data statistics
            const stats = `
                <div style="line-height: 1.8;">
                    <div><i class="fas fa-users"></i> <strong>Members:</strong> ${dataManager.members.length}</div>
                    <div><i class="fas fa-home"></i> <strong>Households:</strong> ${dataManager.households.length}</div>
                    <div><i class="fas fa-money-bill-wave"></i> <strong>Tithing Records:</strong> ${dataManager.tithes.length}</div>
                    <div><i class="fas fa-graduation-cap"></i> <strong>Formations:</strong> ${dataManager.formations.length}</div>
                    <div><i class="fas fa-images"></i> <strong>Photos:</strong> ${dataManager.photos.length}</div>
                    <div><i class="fas fa-history"></i> <strong>Activities:</strong> ${dataManager.activities.length}</div>
                    <div style="margin-top: 0.5rem; padding-top: 0.5rem; border-top: 1px solid #ddd;">
                        <i class="fas fa-database"></i> <strong>Total Records:</strong> ${dataManager.members.length + dataManager.households.length + dataManager.tithes.length + dataManager.formations.length + dataManager.photos.length + dataManager.activities.length}
                    </div>
                </div>
            `;
            document.getElementById('dataStats').innerHTML = stats;
            
            // Load areas for reports
            const reportAreas = document.getElementById('reportAreas');
            reportAreas.innerHTML = '';
            for (const [code, name] of Object.entries(LEYTE_AREAS)) {
                const option = document.createElement('option');
                option.value = code;
                option.textContent = name;
                reportAreas.appendChild(option);
            }
            
            // Load quick area selector
            const quickArea = document.getElementById('quickArea');
            quickArea.innerHTML = '<option value="">Select Area</option>';
            for (const [code, name] of Object.entries(LEYTE_AREAS)) {
                const option = document.createElement('option');
                option.value = code;
                option.textContent = name;
                quickArea.appendChild(option);
            }
        }

        // Utility Functions
        function loadMemberGrid(containerId, selectedIds = []) {
            const container = document.getElementById(containerId);
            container.innerHTML = '';
            
            dataManager.members.forEach(member => {
                if (member.status === 'active') {
                    const div = document.createElement('div');
                    div.className = 'member-checkbox';
                    if (selectedIds.includes(member.id)) {
                        div.classList.add('selected');
                    }
                    
                    div.onclick = function() {
                        const checkbox = this.querySelector('input[type="checkbox"]');
                        checkbox.checked = !checkbox.checked;
                        this.classList.toggle('selected', checkbox.checked);
                    };
                    
                    div.innerHTML = `
                        <input type="checkbox" id="member_${member.id}" value="${member.id}" ${selectedIds.includes(member.id) ? 'checked' : ''}>
                        <label for="member_${member.id}" style="margin: 0; flex: 1;">${member.name}</label>
                        <span class="pill ${member.functionality === 'member' ? 'pill-regular' : 'pill-leader'}">${member.functionality.replace('_', ' ')}</span>
                    `;
                    container.appendChild(div);
                }
            });
        }

        function loadEditMemberGrid(selectedIds) {
            loadMemberGrid('editHouseholdMembersSelect', selectedIds);
        }

        // Filter Functions
        function filterHouseholds() {
            const searchTerm = document.getElementById('householdSearch').value.toLowerCase();
            const areaFilter = document.getElementById('householdAreaFilter').value;
            const statusFilter = document.getElementById('householdStatusFilter').value;
            
            const rows = document.querySelectorAll('#householdsData tr');
            rows.forEach(row => {
                const name = row.cells[0].textContent.toLowerCase();
                const area = row.cells[1].textContent.toLowerCase();
                const leader = row.cells[2].textContent.toLowerCase();
                const status = row.cells[6].querySelector('.pill').textContent;
                
                const matchesSearch = !searchTerm || 
                    name.includes(searchTerm) || 
                    area.includes(searchTerm) || 
                    leader.includes(searchTerm);
                
                const matchesArea = !areaFilter || area.includes(areaFilter.toLowerCase());
                const matchesStatus = !statusFilter || status === statusFilter;
                
                row.style.display = matchesSearch && matchesArea && matchesStatus ? '' : 'none';
            });
        }

        function filterMembers() {
            const searchTerm = document.getElementById('memberSearch').value.toLowerCase();
            const areaFilter = document.getElementById('memberAreaFilter').value;
            const statusFilter = document.getElementById('memberStatusFilter').value;
            
            const rows = document.querySelectorAll('#membersList tr');
            rows.forEach(row => {
                const name = row.cells[0].textContent.toLowerCase();
                const area = row.cells[2].textContent.toLowerCase();
                const functionality = row.cells[4].querySelector('.pill').textContent.toLowerCase();
                const status = row.cells[6].querySelector('.pill').textContent;
                
                const matchesSearch = !searchTerm || 
                    name.includes(searchTerm) || 
                    area.includes(searchTerm) || 
                    functionality.includes(searchTerm);
                
                const matchesArea = !areaFilter || area.includes(areaFilter.toLowerCase());
                const matchesStatus = !statusFilter || status === statusFilter;
                
                row.style.display = matchesSearch && matchesArea && matchesStatus ? '' : 'none';
            });
        }

        function filterFormations() {
            const areaFilter = document.getElementById('formationAreaFilter').value;
            const statusFilter = document.getElementById('formationStatusFilter').value;
            
            const rows = document.querySelectorAll('#formationsList tr');
            rows.forEach(row => {
                const area = row.cells[2].textContent.toLowerCase();
                const status = row.cells[6].querySelector('.pill').textContent;
                
                const matchesArea = !areaFilter || area.includes(areaFilter.toLowerCase());
                const matchesStatus = !statusFilter || status === statusFilter;
                
                row.style.display = matchesArea && matchesStatus ? '' : 'none';
            });
        }

        function filterTithes() {
            const searchTerm = document.getElementById('titheSearch').value.toLowerCase();
            const monthFilter = document.getElementById('titheMonthFilter').value;
            const areaFilter = document.getElementById('titheAreaFilter').value;
            
            const rows = document.querySelectorAll('#tithingList tr');
            rows.forEach(row => {
                const name = row.cells[1].textContent.toLowerCase();
                const area = row.cells[4].textContent.toLowerCase();
                const month = row.cells[5].textContent.split(' ')[0].toLowerCase();
                const monthNumber = getMonthNumber(month);
                
                const matchesSearch = !searchTerm || name.includes(searchTerm);
                const matchesMonth = !monthFilter || monthNumber.toString() === monthFilter;
                const matchesArea = !areaFilter || area.includes(areaFilter.toLowerCase());
                
                row.style.display = matchesSearch && matchesMonth && matchesArea ? '' : 'none';
            });
        }

        function getMonthNumber(monthName) {
            const months = {
                'january': 1, 'february': 2, 'march': 3, 'april': 4,
                'may': 5, 'june': 6, 'july': 7, 'august': 8,
                'september': 9, 'october': 10, 'november': 11, 'december': 12
            };
            return months[monthName.toLowerCase()] || 0;
        }

        function filterGallery(year) {
            const areaFilter = document.getElementById('galleryAreaFilter').value;
            const activityFilter = document.getElementById('galleryActivityFilter').value;
            
            const photos = document.querySelectorAll('#photoGallery .photo-card');
            photos.forEach(photo => {
                const area = photo.querySelector('.photo-meta div:nth-child(2)').textContent.toLowerCase();
                const activityType = photo.querySelector('.photo-meta div:nth-child(3)').textContent.toLowerCase();
                const photoYear = new Date(photo.querySelector('.photo-meta div:first-child').textContent).getFullYear();
                
                const matchesYear = year === 'all' || photoYear === year;
                const matchesArea = !areaFilter || area.includes(areaFilter.toLowerCase());
                const matchesActivity = !activityFilter || activityType.includes(activityFilter.toLowerCase());
                
                photo.style.display = matchesYear && matchesArea && matchesActivity ? '' : 'none';
            });
        }

        // Data Management Functions
        function exportAllData() {
            const data = dataManager.exportData();
            const blob = new Blob([data], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `sold_data_export_${new Date().toISOString().slice(0,10)}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            showToast('Data exported successfully!');
        }

        function importData() {
            const fileInput = document.getElementById('importFile');
            if (!fileInput.files.length) {
                showToast('Please select a file to import', 'error');
                return;
            }
            
            const file = fileInput.files[0];
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    if (dataManager.importData(e.target.result)) {
                        showToast('Data imported successfully!');
                        // Refresh all views
                        loadDashboard();
                        loadHouseholds();
                        loadMembers();
                        loadFormations();
                        loadTithing();
                        loadGrowthAnalytics();
                        loadPhotoGallery();
                        loadDataManagement();
                    } else {
                        showToast('Error importing data', 'error');
                    }
                } catch (error) {
                    showToast('Invalid data format', 'error');
                }
            };
            
            reader.readAsText(file);
        }

        function clearAllData() {
            if (confirm('⚠️ WARNING: This will delete ALL data including members, households, tithing records, formations, and photos. This action cannot be undone!\n\nAre you absolutely sure?')) {
                if (dataManager.clearData()) {
                    showToast('All data cleared successfully!');
                    // Refresh all views
                    loadDashboard();
                    loadHouseholds();
                    loadMembers();
                    loadFormations();
                    loadTithing();
                    loadGrowthAnalytics();
                    loadPhotoGallery();
                    loadDataManagement();
                }
            }
        }

        function createBackup() {
            const data = dataManager.exportData();
            const blob = new Blob([data], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `sold_backup_${new Date().toISOString().slice(0,10)}.json`;
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
            showToast('Backup created successfully!');
        }

        function restoreBackup() {
            const fileInput = document.getElementById('restoreFile');
            if (!fileInput.files.length) {
                showToast('Please select a backup file', 'error');
                return;
            }
            
            const file = fileInput.files[0];
            const reader = new FileReader();
            
            reader.onload = function(e) {
                try {
                    const data = JSON.parse(e.target.result);
                    if (confirm(`This will replace all current data with backup data containing:
• ${data.members?.length || 0} members
• ${data.households?.length || 0} households
• ${data.tithes?.length || 0} tithing records
• ${data.formations?.length || 0} formations
• ${data.photos?.length || 0} photos

Are you sure you want to restore this backup?`)) {
                        if (dataManager.importData(e.target.result)) {
                            showToast('Backup restored successfully!');
                            // Refresh all views
                            loadDashboard();
                            loadHouseholds();
                            loadMembers();
                            loadFormations();
                            loadTithing();
                            loadGrowthAnalytics();
                            loadPhotoGallery();
                            loadDataManagement();
                        } else {
                            showToast('Error restoring backup', 'error');
                        }
                    }
                } catch (error) {
                    showToast('Invalid backup file format', 'error');
                }
            };
            
            reader.readAsText(file);
        }

        function checkDataIntegrity() {
            const issues = dataManager.checkDataIntegrity();
            const resultsDiv = document.getElementById('integrityResults');
            
            if (issues.length === 0) {
                resultsDiv.innerHTML = `
                    <div style="background: #E8F5E9; color: #2E7D32; padding: 1rem; border-radius: 6px; margin-top: 1rem;">
                        <i class="fas fa-check-circle"></i> No data integrity issues found! All data is consistent.
                    </div>
                `;
            } else {
                resultsDiv.innerHTML = `
                    <div style="background: #FFF3E0; color: #EF6C00; padding: 1rem; border-radius: 6px; margin-top: 1rem;">
                        <h4 style="margin-bottom: 0.5rem;"><i class="fas fa-exclamation-triangle"></i> Found ${issues.length} Data Integrity Issues:</h4>
                        <ul style="margin-left: 1.5rem;">
                            ${issues.map(issue => `<li>${issue}</li>`).join('')}
                        </ul>
                    </div>
                `;
            }
        }

        function fixDataIssues() {
            const fixes = dataManager.fixDataIssues();
            const resultsDiv = document.getElementById('integrityResults');
            
            if (fixes.length === 0) {
                resultsDiv.innerHTML = `
                    <div style="background: #E8F5E9; color: #2E7D32; padding: 1rem; border-radius: 6px; margin-top: 1rem;">
                        <i class="fas fa-check-circle"></i> No fixes were needed. Data is already consistent.
                    </div>
                `;
            } else {
                resultsDiv.innerHTML = `
                    <div style="background: #E8F5E9; color: #2E7D32; padding: 1rem; border-radius: 6px; margin-top: 1rem;">
                        <h4 style="margin-bottom: 0.5rem;"><i class="fas fa-check-circle"></i> Applied ${fixes.length} Fixes:</h4>
                        <ul style="margin-left: 1.5rem;">
                            ${fixes.map(fix => `<li>${fix}</li>`).join('')}
                        </ul>
                        <div style="margin-top: 0.5rem; font-size: 0.9rem;">
                            Data has been fixed and saved successfully!
                        </div>
                    </div>
                `;
                // Refresh views
                loadDashboard();
                loadHouseholds();
                loadMembers();
                loadFormations();
                loadTithing();
            }
        }

        function loadSampleData() {
            if (confirm('This will load sample data for demonstration purposes. Any existing data will be preserved.\n\nContinue?')) {
                dataManager.initSampleData();
                showToast('Sample data loaded successfully!');
                loadDashboard();
                loadHouseholds();
                loadMembers();
                loadFormations();
                loadTithing();
                loadGrowthAnalytics();
                loadPhotoGallery();
                loadDataManagement();
            }
        }

        function generateTestData() {
            const count = prompt('How many test members to generate?', '10');
            if (count && !isNaN(count) && count > 0) {
                dataManager.generateTestData(parseInt(count));
                showToast(`Generated ${count} test records!`);
                loadDashboard();
                loadHouseholds();
                loadMembers();
                loadFormations();
                loadTithing();
                loadGrowthAnalytics();
                loadPhotoGallery();
                loadDataManagement();
            }
        }

        // Simple report functions (PDF/Excel would need additional libraries)
        function generatePDFReport(type) {
            showToast(`PDF report generation for ${type} would require additional libraries like jsPDF`, 'warning');
        }

        function generateExcelReport(type) {
            showToast(`Excel report generation for ${type} would require additional libraries like SheetJS`, 'warning');
        }

        function generateCustomReport() {
            showToast('Custom report generation would require additional libraries', 'warning');
        }

        function generateQuickReport() {
            showToast('Quick report generation would require additional libraries', 'warning');
        }

        function generateAreaReport() {
            showToast('Area report generation would require additional libraries', 'warning');
        }

        function generateFormationReport() {
            showToast('Formation report generation would require additional libraries', 'warning');
        }

        // Event Listeners
        document.addEventListener('DOMContentLoaded', function() {
            // Tab switching
            document.querySelectorAll('.tab').forEach(tab => {
                tab.addEventListener('click', function() {
                    const tabName = this.getAttribute('data-tab');
                    switchTab(tabName);
                });
            });
            
            // Secondary tabs for members
            document.querySelectorAll('.tab-secondary').forEach(tab => {
                tab.addEventListener('click', function() {
                    document.querySelectorAll('.tab-secondary').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    const filter = this.getAttribute('data-member-filter');
                    filterMembersByType(filter);
                });
            });
            
            // Secondary tabs for formations
            document.querySelectorAll('.tab-secondary[data-formation-year]').forEach(tab => {
                tab.addEventListener('click', function() {
                    document.querySelectorAll('.tab-secondary[data-formation-year]').forEach(t => t.classList.remove('active'));
                    this.classList.add('active');
                    const year = this.getAttribute('data-formation-year');
                    filterFormationsByYear(year);
                });
            });
            
            // Load dashboard on startup
            loadDashboard();
            
            // Initialize year selector for tithing
            document.querySelectorAll('.year-btn').forEach((btn, index) => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('.year-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    const year = parseInt(this.textContent);
                    currentTithingYear = year;
                    loadTithing();
                });
            });
            
            // Initialize growth year selector
            document.querySelectorAll('#growth .year-btn').forEach(btn => {
                btn.addEventListener('click', function() {
                    document.querySelectorAll('#growth .year-btn').forEach(b => b.classList.remove('active'));
                    this.classList.add('active');
                    const year = this.textContent === 'All Years' ? 'all' : parseInt(this.textContent);
                    currentGrowthYear = year;
                    // In a real implementation, this would filter the growth charts
                });
            });
            
            // File input handlers
            document.getElementById('importFile').addEventListener('change', handleFileSelect);
            document.getElementById('restoreFile').addEventListener('change', handleRestoreFile);
        });

        function handleFileSelect(event) {
            const file = event.target.files[0];
            if (file) {
                console.log('File selected:', file.name);
            }
        }

        function handleRestoreFile(event) {
            const file = event.target.files[0];
            if (file) {
                console.log('Backup file selected:', file.name);
            }
        }

        // Additional helper functions
        function filterMembersByType(filter) {
            const rows = document.querySelectorAll('#membersList tr');
            rows.forEach(row => {
                switch(filter) {
                    case 'all':
                        row.style.display = '';
                        break;
                    case 'leaders':
                        const functionality = row.cells[4].querySelector('.pill').textContent;
                        row.style.display = functionality.includes('leader') || functionality.includes('coordinator') ? '' : 'none';
                        break;
                    case 'new':
                        const memberSince = new Date(row.cells[5].textContent);
                        const currentYear = new Date().getFullYear();
                        row.style.display = memberSince.getFullYear() === currentYear ? '' : 'none';
                        break;
                    case 'need_followup':
                        // This would check for members who haven't attended recent activities
                        row.style.display = '';
                        break;
                }
            });
        }

        function filterFormationsByYear(year) {
            const rows = document.querySelectorAll('#formationsList tr');
            rows.forEach(row => {
                const date = new Date(row.cells[0].textContent);
                const formationYear = date.getFullYear();
                row.style.display = formationYear.toString() === year ? '' : 'none';
            });
        }

        // Initialize the system
        console.log('SOLD Growth Management System initialized successfully!');
    </script>
</body>
</html>